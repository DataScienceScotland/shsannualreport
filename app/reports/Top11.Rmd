---
params:
  report_title: ""
  local_authority: ""
  year: ""
  topic_data: ""
  comparison_type: ""
  comparator: ""
title: "`r params$report_title`"
output:
  pdf_document:
    toc: yes
    fig_caption: false
header-includes:
    - \hypersetup{colorlinks=true, linkcolor = black, urlcolor = [RGB]{0, 163, 163}}
    - \usepackage{titling}
    - \pretitle{\begin{center}
      \includegraphics[width=2in,height=2in]{../www/new_logo.png}\LARGE\\}
    - \posttitle{\end{center}}
    - \renewcommand{\familydefault}{\sfdefault}
classoption: landscape
fontsize: 10pt
papersize: a4
geometry: margin=1.5cm
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo=FALSE)
options(tinytex.verbose = TRUE)

library(knitr)
library(dplyr)
library(kableExtra)
library(png)
library(tidyselect)

local_authority <- params$local_authority
year <- params$year
topic_data <- params$topic_data
comparison_type <- params$comparison_type
comparator <- params$comparator

Table_11.1 <- topic_data[[1]]
Table_11.2 <- topic_data[[2]]
Figure_11.1 <- topic_data[[3]]
Figure_11.2 <- topic_data[[4]]
Table_11.3 <- topic_data[[5]]
Table_11.4 <- topic_data[[6]]
Figure_11.3 <- topic_data[[7]]
Table_11.5 <- topic_data[[8]]
Table_11.6 <- topic_data[[9]]
Table_11.7 <- topic_data[[10]]
Table_11.8 <- topic_data[[11]]
Table_11.9 <- topic_data[[12]]
Table_11.10 <- topic_data[[13]]
Table_11.11 <- topic_data[[14]]
Table_11.12 <- topic_data[[15]]
Figure_11.4 <- topic_data[[16]]
Table_11.13 <- topic_data[[17]]
Table_11.14 <- topic_data[[18]]
Figure_11.5 <- topic_data[[19]]
Table_11.15 <- topic_data[[20]]
Table_11.16 <- topic_data[[21]]
Table_11.17 <- topic_data[[22]]
Table_11.18 <- topic_data[[23]]

main_table_title <- paste0(local_authority, ", ", year)

eval_comparison <- ifelse(comparison_type == "No comparison", FALSE, TRUE)

eval_comparison_time_series <- ifelse(comparison_type == "Year" | comparison_type == "No comparison", FALSE, TRUE)

comparison_table_title <- if (comparison_type == "Local Authority") {
  paste0(comparator, ", ", year)
} else if (comparison_type == "Year") {
  paste0(local_authority, ", ", comparator)
} else {
  NULL
  }

```

## Acknowledgements
The Scottish Government acknowledges and thanks the 10,530
people across Scotland who gave their time to take part in the
Scottish Household Survey 2018.
This report was produced by the Scottish Household Survey Project Team
at the Scottish Government.
We would also like to thank all the Scottish Government lead analysts who
contributed to the project.
Finally, special thanks to Ipsos MORI and their interviewers for continuous
and relentless efforts during the fieldwork.

## Key

```{=latex}
$ \color[RGB]{0, 163, 163} \blacksquare $ Significantly higher $ \color[RGB]{195, 195, 255} \blacksquare $ Significantly lower
```
## Table 11.1: Whether involved in any Volunteering (Formal or Informal) in the last 12 months by gender
### Column percentages, Adults
### Question first asked in 2018

### `r main_table_title`

```{r eval=(eval_comparison == FALSE)}
if (!is.null(Table_11.1)) {
Table_11.1 %>%
kable("latex", escape = TRUE, booktabs = T)
 } else {
        asis_output("### There is no data to show for this table within the specified parameters")
      }
```

```{r eval=eval_comparison}
if (!is.null(Table_11.1)) {
if (length(grep("_2", colnames(Table_11.1))) > 0) {
colnames(Table_11.1) <- gsub("%", "\\\\%", colnames(Table_11.1))
main_column_names <- colnames(Table_11.1)[!grepl("_2", colnames(Table_11.1))]
significance_column_names <- colnames(Table_11.1)[grepl("_sig", colnames(Table_11.1))]

Table_11.1 %>% select(tidyselect::all_of(main_column_names)) %>%
mutate(`Man / Boy` = cell_spec(`Man / Boy`, "latex", background = case_when(`Man / Boy_sig` == "HIGHER" ~ "#00A3A3", `Man / Boy_sig` == "LOWER" ~ "#C3C3FF", TRUE ~ "#FFFFFF")),
`Woman / Girl` = cell_spec(`Woman / Girl`, "latex", background = case_when(`Woman / Girl_sig` == "HIGHER" ~ "#00A3A3", `Woman / Girl_sig` == "LOWER" ~ "#C3C3FF", TRUE ~ "#FFFFFF")),
`Refused` = cell_spec(`Refused`, "latex", background = case_when(`Refused_sig` == "HIGHER" ~ "#00A3A3", `Refused_sig` == "LOWER" ~ "#C3C3FF", TRUE ~ "#FFFFFF")),
`In another way` = cell_spec(`In another way`, "latex", background = case_when(`In another way_sig` == "HIGHER" ~ "#00A3A3", `In another way_sig` == "LOWER" ~ "#C3C3FF", TRUE ~ "#FFFFFF"))

) %>%
select(!tidyselect::all_of(significance_column_names)) %>%
kable("latex", escape = FALSE, booktabs = T)
} else {
Table_11.1 %>%
kable("latex", escape = TRUE, booktabs = T)
}
} else {
  asis_output("### There is no data to show for this table within the specified parameters, or there is no data to compare with.")
}
```
```{r eval=eval_comparison}
asis_output(paste0("### ", comparison_table_title))
```

```{r eval=eval_comparison}
if (!is.null(Table_11.1) && length(grep("_2", colnames(Table_11.1))) > 0) {
comparison_column_names <- colnames(Table_11.1)[grepl("_2", colnames(Table_11.1))]
comparison_rename_column_names <- gsub("_2", "", comparison_column_names)

Table_11.1 %>% select(tidyselect::all_of(colnames(Table_11.1)[!colnames(Table_11.1) %in% comparison_rename_column_names])) %>%
rename_at(comparison_column_names, ~ comparison_rename_column_names) %>%
mutate(`Man / Boy` = cell_spec(`Man / Boy`, "latex", background = case_when(`Man / Boy_sig` == "HIGHER" ~ "#C3C3FF", `Man / Boy_sig` == "LOWER" ~ "#00A3A3", TRUE ~ "#FFFFFF")),
`Woman / Girl` = cell_spec(`Woman / Girl`, "latex", background = case_when(`Woman / Girl_sig` == "HIGHER" ~ "#C3C3FF", `Woman / Girl_sig` == "LOWER" ~ "#00A3A3", TRUE ~ "#FFFFFF")),
`Refused` = cell_spec(`Refused`, "latex", background = case_when(`Refused_sig` == "HIGHER" ~ "#C3C3FF", `Refused_sig` == "LOWER" ~ "#00A3A3", TRUE ~ "#FFFFFF")),
`In another way` = cell_spec(`In another way`, "latex", background = case_when(`In another way_sig` == "HIGHER" ~ "#C3C3FF", `In another way_sig` == "LOWER" ~ "#00A3A3", TRUE ~ "#FFFFFF"))) %>%
        select(!tidyselect::all_of(significance_column_names)) %>%
        kable("latex", escape = FALSE, booktabs = T)
} else {
asis_output("### There is no data to show for this table within the specified parameters, or there is no data to compare with.")
}
```
## Table 11.2: Whether provided unpaid help to organisations or groups in the last 12 months by gender
### Column percentages, Adults

### `r main_table_title`

```{r eval=(eval_comparison == FALSE)}
if (!is.null(Table_11.2)) {
Table_11.2 %>%
kable("latex", escape = TRUE, booktabs = T)
 } else {
        asis_output("### There is no data to show for this table within the specified parameters")
      }
```

```{r eval=eval_comparison}
if (!is.null(Table_11.2)) {
if (length(grep("_2", colnames(Table_11.2))) > 0) {
colnames(Table_11.2) <- gsub("%", "\\\\%", colnames(Table_11.2))
main_column_names <- colnames(Table_11.2)[!grepl("_2", colnames(Table_11.2))]
significance_column_names <- colnames(Table_11.2)[grepl("_sig", colnames(Table_11.2))]

Table_11.2 %>% select(tidyselect::all_of(main_column_names)) %>%
mutate(`Male` = cell_spec(`Male`, "latex", background = case_when(`Male_sig` == "HIGHER" ~ "#00A3A3", `Male_sig` == "LOWER" ~ "#C3C3FF", TRUE ~ "#FFFFFF")),
`Female` = cell_spec(`Female`, "latex", background = case_when(`Female_sig` == "HIGHER" ~ "#00A3A3", `Female_sig` == "LOWER" ~ "#C3C3FF", TRUE ~ "#FFFFFF")),
`In another way` = cell_spec(`In another way`, "latex", background = case_when(`In another way_sig` == "HIGHER" ~ "#00A3A3", `In another way_sig` == "LOWER" ~ "#C3C3FF", TRUE ~ "#FFFFFF")),
`Refused` = cell_spec(`Refused`, "latex", background = case_when(`Refused_sig` == "HIGHER" ~ "#00A3A3", `Refused_sig` == "LOWER" ~ "#C3C3FF", TRUE ~ "#FFFFFF"))

) %>%
select(!tidyselect::all_of(significance_column_names)) %>%
kable("latex", escape = FALSE, booktabs = T)
} else {
Table_11.2 %>%
kable("latex", escape = TRUE, booktabs = T)
}
} else {
  asis_output("### There is no data to show for this table within the specified parameters, or there is no data to compare with.")
}
```
```{r eval=eval_comparison}
asis_output(paste0("### ", comparison_table_title))
```

```{r eval=eval_comparison}
if (!is.null(Table_11.2) && length(grep("_2", colnames(Table_11.2))) > 0) {
comparison_column_names <- colnames(Table_11.2)[grepl("_2", colnames(Table_11.2))]
comparison_rename_column_names <- gsub("_2", "", comparison_column_names)

Table_11.2 %>% select(tidyselect::all_of(colnames(Table_11.2)[!colnames(Table_11.2) %in% comparison_rename_column_names])) %>%
rename_at(comparison_column_names, ~ comparison_rename_column_names) %>%
mutate(`Male` = cell_spec(`Male`, "latex", background = case_when(`Male_sig` == "HIGHER" ~ "#C3C3FF", `Male_sig` == "LOWER" ~ "#00A3A3", TRUE ~ "#FFFFFF")),
`Female` = cell_spec(`Female`, "latex", background = case_when(`Female_sig` == "HIGHER" ~ "#C3C3FF", `Female_sig` == "LOWER" ~ "#00A3A3", TRUE ~ "#FFFFFF")),
`In another way` = cell_spec(`In another way`, "latex", background = case_when(`In another way_sig` == "HIGHER" ~ "#C3C3FF", `In another way_sig` == "LOWER" ~ "#00A3A3", TRUE ~ "#FFFFFF")),
`Refused` = cell_spec(`Refused`, "latex", background = case_when(`Refused_sig` == "HIGHER" ~ "#C3C3FF", `Refused_sig` == "LOWER" ~ "#00A3A3", TRUE ~ "#FFFFFF"))) %>%
        select(!tidyselect::all_of(significance_column_names)) %>%
        kable("latex", escape = FALSE, booktabs = T)
} else {
asis_output("### There is no data to show for this table within the specified parameters, or there is no data to compare with.")
}
```
## Figure 11.1: Whether provided unpaid help to organisations or groups in the last 12 months by gender
### Column percentages, Adults

### `r main_table_title`

```{r eval=(eval_comparison_time_series == FALSE)}
if (!is.null(Figure_11.1)) {
Figure_11.1 %>%
kable("latex", escape = TRUE, booktabs = T)
 } else {
        asis_output("### There is no data to show for this table within the specified parameters")
      }
```

```{r eval=eval_comparison_time_series}
if (!is.null(Figure_11.1)) {
if (length(grep("_2", colnames(Figure_11.1))) > 0) {
colnames(Figure_11.1) <- gsub("%", "\\\\%", colnames(Figure_11.1))
main_column_names <- colnames(Figure_11.1)[!grepl("_2", colnames(Figure_11.1))]
significance_column_names <- colnames(Figure_11.1)[grepl("_sig", colnames(Figure_11.1))]

Figure_11.1 %>% select(tidyselect::all_of(main_column_names)) %>%
mutate(`2009/2010` = cell_spec(`2009/2010`, "latex", background = case_when(`2009/2010_sig` == "HIGHER" ~ "#00A3A3", `2009/2010_sig` == "LOWER" ~ "#C3C3FF", TRUE ~ "#FFFFFF")),
`2011` = cell_spec(`2011`, "latex", background = case_when(`2011_sig` == "HIGHER" ~ "#00A3A3", `2011_sig` == "LOWER" ~ "#C3C3FF", TRUE ~ "#FFFFFF")),
`2012` = cell_spec(`2012`, "latex", background = case_when(`2012_sig` == "HIGHER" ~ "#00A3A3", `2012_sig` == "LOWER" ~ "#C3C3FF", TRUE ~ "#FFFFFF")),
`2013` = cell_spec(`2013`, "latex", background = case_when(`2013_sig` == "HIGHER" ~ "#00A3A3", `2013_sig` == "LOWER" ~ "#C3C3FF", TRUE ~ "#FFFFFF")),
`2014` = cell_spec(`2014`, "latex", background = case_when(`2014_sig` == "HIGHER" ~ "#00A3A3", `2014_sig` == "LOWER" ~ "#C3C3FF", TRUE ~ "#FFFFFF")),
`2015` = cell_spec(`2015`, "latex", background = case_when(`2015_sig` == "HIGHER" ~ "#00A3A3", `2015_sig` == "LOWER" ~ "#C3C3FF", TRUE ~ "#FFFFFF")),
`2016` = cell_spec(`2016`, "latex", background = case_when(`2016_sig` == "HIGHER" ~ "#00A3A3", `2016_sig` == "LOWER" ~ "#C3C3FF", TRUE ~ "#FFFFFF")),
`2017` = cell_spec(`2017`, "latex", background = case_when(`2017_sig` == "HIGHER" ~ "#00A3A3", `2017_sig` == "LOWER" ~ "#C3C3FF", TRUE ~ "#FFFFFF")),
`2018` = cell_spec(`2018`, "latex", background = case_when(`2018_sig` == "HIGHER" ~ "#00A3A3", `2018_sig` == "LOWER" ~ "#C3C3FF", TRUE ~ "#FFFFFF"))

) %>%
select(!tidyselect::all_of(significance_column_names)) %>%
kable("latex", escape = FALSE, booktabs = T)
} else {
Figure_11.1 %>%
kable("latex", escape = TRUE, booktabs = T)
}
} else {
  asis_output("### There is no data to show for this table within the specified parameters, or there is no data to compare with.")
}
```
```{r eval=eval_comparison_time_series}
asis_output(paste0("### ", comparison_table_title))
```

```{r eval=eval_comparison_time_series}
if (!is.null(Figure_11.1) && length(grep("_2", colnames(Figure_11.1))) > 0) {
comparison_column_names <- colnames(Figure_11.1)[grepl("_2", colnames(Figure_11.1))]
comparison_rename_column_names <- gsub("_2", "", comparison_column_names)

Figure_11.1 %>% select(tidyselect::all_of(colnames(Figure_11.1)[!colnames(Figure_11.1) %in% comparison_rename_column_names])) %>%
rename_at(comparison_column_names, ~ comparison_rename_column_names) %>%
mutate(`2009/2010` = cell_spec(`2009/2010`, "latex", background = case_when(`2009/2010_sig` == "HIGHER" ~ "#C3C3FF", `2009/2010_sig` == "LOWER" ~ "#00A3A3", TRUE ~ "#FFFFFF")),
`2011` = cell_spec(`2011`, "latex", background = case_when(`2011_sig` == "HIGHER" ~ "#C3C3FF", `2011_sig` == "LOWER" ~ "#00A3A3", TRUE ~ "#FFFFFF")),
`2012` = cell_spec(`2012`, "latex", background = case_when(`2012_sig` == "HIGHER" ~ "#C3C3FF", `2012_sig` == "LOWER" ~ "#00A3A3", TRUE ~ "#FFFFFF")),
`2013` = cell_spec(`2013`, "latex", background = case_when(`2013_sig` == "HIGHER" ~ "#C3C3FF", `2013_sig` == "LOWER" ~ "#00A3A3", TRUE ~ "#FFFFFF")),
`2014` = cell_spec(`2014`, "latex", background = case_when(`2014_sig` == "HIGHER" ~ "#C3C3FF", `2014_sig` == "LOWER" ~ "#00A3A3", TRUE ~ "#FFFFFF")),
`2015` = cell_spec(`2015`, "latex", background = case_when(`2015_sig` == "HIGHER" ~ "#C3C3FF", `2015_sig` == "LOWER" ~ "#00A3A3", TRUE ~ "#FFFFFF")),
`2016` = cell_spec(`2016`, "latex", background = case_when(`2016_sig` == "HIGHER" ~ "#C3C3FF", `2016_sig` == "LOWER" ~ "#00A3A3", TRUE ~ "#FFFFFF")),
`2017` = cell_spec(`2017`, "latex", background = case_when(`2017_sig` == "HIGHER" ~ "#C3C3FF", `2017_sig` == "LOWER" ~ "#00A3A3", TRUE ~ "#FFFFFF")),
`2018` = cell_spec(`2018`, "latex", background = case_when(`2018_sig` == "HIGHER" ~ "#C3C3FF", `2018_sig` == "LOWER" ~ "#00A3A3", TRUE ~ "#FFFFFF"))) %>%
        select(!tidyselect::all_of(significance_column_names)) %>%
        kable("latex", escape = FALSE, booktabs = T)
} else {
asis_output("### There is no data to show for this table within the specified parameters, or there is no data to compare with.")
}
```
## Figure 11.2: Percentage providing unpaid help to organisations or groups in the last 12 months by age within gender
### Column percentages, Adults
### Split of gender within age is not possible due to base sizes

### `r main_table_title`

```{r eval=(eval_comparison == FALSE)}
if (!is.null(Figure_11.2)) {
Figure_11.2 %>%
kable("latex", escape = TRUE, booktabs = T)
 } else {
        asis_output("### There is no data to show for this table within the specified parameters")
      }
```

```{r eval=eval_comparison}
if (!is.null(Figure_11.2)) {
if (length(grep("_2", colnames(Figure_11.2))) > 0) {
colnames(Figure_11.2) <- gsub("%", "\\\\%", colnames(Figure_11.2))
main_column_names <- colnames(Figure_11.2)[!grepl("_2", colnames(Figure_11.2))]
significance_column_names <- colnames(Figure_11.2)[grepl("_sig", colnames(Figure_11.2))]

Figure_11.2 %>% select(tidyselect::all_of(main_column_names)) %>%
mutate(`16-39` = cell_spec(`16-39`, "latex", background = case_when(`16-39_sig` == "HIGHER" ~ "#00A3A3", `16-39_sig` == "LOWER" ~ "#C3C3FF", TRUE ~ "#FFFFFF")),
`40-64` = cell_spec(`40-64`, "latex", background = case_when(`40-64_sig` == "HIGHER" ~ "#00A3A3", `40-64_sig` == "LOWER" ~ "#C3C3FF", TRUE ~ "#FFFFFF")),
`65+` = cell_spec(`65+`, "latex", background = case_when(`65+_sig` == "HIGHER" ~ "#00A3A3", `65+_sig` == "LOWER" ~ "#C3C3FF", TRUE ~ "#FFFFFF"))

) %>%
select(!tidyselect::all_of(significance_column_names)) %>%
kable("latex", escape = FALSE, booktabs = T)
} else {
Figure_11.2 %>%
kable("latex", escape = TRUE, booktabs = T)
}
} else {
  asis_output("### There is no data to show for this table within the specified parameters, or there is no data to compare with.")
}
```
```{r eval=eval_comparison}
asis_output(paste0("### ", comparison_table_title))
```

```{r eval=eval_comparison}
if (!is.null(Figure_11.2) && length(grep("_2", colnames(Figure_11.2))) > 0) {
comparison_column_names <- colnames(Figure_11.2)[grepl("_2", colnames(Figure_11.2))]
comparison_rename_column_names <- gsub("_2", "", comparison_column_names)

Figure_11.2 %>% select(tidyselect::all_of(colnames(Figure_11.2)[!colnames(Figure_11.2) %in% comparison_rename_column_names])) %>%
rename_at(comparison_column_names, ~ comparison_rename_column_names) %>%
mutate(`16-39` = cell_spec(`16-39`, "latex", background = case_when(`16-39_sig` == "HIGHER" ~ "#C3C3FF", `16-39_sig` == "LOWER" ~ "#00A3A3", TRUE ~ "#FFFFFF")),
`40-64` = cell_spec(`40-64`, "latex", background = case_when(`40-64_sig` == "HIGHER" ~ "#C3C3FF", `40-64_sig` == "LOWER" ~ "#00A3A3", TRUE ~ "#FFFFFF")),
`65+` = cell_spec(`65+`, "latex", background = case_when(`65+_sig` == "HIGHER" ~ "#C3C3FF", `65+_sig` == "LOWER" ~ "#00A3A3", TRUE ~ "#FFFFFF"))) %>%
        select(!tidyselect::all_of(significance_column_names)) %>%
        kable("latex", escape = FALSE, booktabs = T)
} else {
asis_output("### There is no data to show for this table within the specified parameters, or there is no data to compare with.")
}
```
## Table 11.3: Whether provided unpaid help to organisations or groups in the last 12 months by current economic situation
### Column percentages, Adults

### `r main_table_title`

```{r eval=(eval_comparison == FALSE)}
if (!is.null(Table_11.3)) {
Table_11.3 %>%
kable("latex", escape = TRUE, booktabs = T)
 } else {
        asis_output("### There is no data to show for this table within the specified parameters")
      }
```

```{r eval=eval_comparison}
if (!is.null(Table_11.3)) {
if (length(grep("_2", colnames(Table_11.3))) > 0) {
colnames(Table_11.3) <- gsub("%", "\\\\%", colnames(Table_11.3))
main_column_names <- colnames(Table_11.3)[!grepl("_2", colnames(Table_11.3))]
significance_column_names <- colnames(Table_11.3)[grepl("_sig", colnames(Table_11.3))]

Table_11.3 %>% select(tidyselect::all_of(main_column_names)) %>%
mutate(`Self employed/full-/part-/time employment` = cell_spec(`Self employed/full-/part-/time employment`, "latex", background = case_when(`Self employed/full-/part-/time employment_sig` == "HIGHER" ~ "#00A3A3", `Self employed/full-/part-/time employment_sig` == "LOWER" ~ "#C3C3FF", TRUE ~ "#FFFFFF")),
`Other` = cell_spec(`Other`, "latex", background = case_when(`Other_sig` == "HIGHER" ~ "#00A3A3", `Other_sig` == "LOWER" ~ "#C3C3FF", TRUE ~ "#FFFFFF")),
`Permanently retired from work` = cell_spec(`Permanently retired from work`, "latex", background = case_when(`Permanently retired from work_sig` == "HIGHER" ~ "#00A3A3", `Permanently retired from work_sig` == "LOWER" ~ "#C3C3FF", TRUE ~ "#FFFFFF"))

) %>%
select(!tidyselect::all_of(significance_column_names)) %>%
kable("latex", escape = FALSE, booktabs = T)
} else {
Table_11.3 %>%
kable("latex", escape = TRUE, booktabs = T)
}
} else {
  asis_output("### There is no data to show for this table within the specified parameters, or there is no data to compare with.")
}
```
```{r eval=eval_comparison}
asis_output(paste0("### ", comparison_table_title))
```

```{r eval=eval_comparison}
if (!is.null(Table_11.3) && length(grep("_2", colnames(Table_11.3))) > 0) {
comparison_column_names <- colnames(Table_11.3)[grepl("_2", colnames(Table_11.3))]
comparison_rename_column_names <- gsub("_2", "", comparison_column_names)

Table_11.3 %>% select(tidyselect::all_of(colnames(Table_11.3)[!colnames(Table_11.3) %in% comparison_rename_column_names])) %>%
rename_at(comparison_column_names, ~ comparison_rename_column_names) %>%
mutate(`Self employed/full-/part-/time employment` = cell_spec(`Self employed/full-/part-/time employment`, "latex", background = case_when(`Self employed/full-/part-/time employment_sig` == "HIGHER" ~ "#C3C3FF", `Self employed/full-/part-/time employment_sig` == "LOWER" ~ "#00A3A3", TRUE ~ "#FFFFFF")),
`Other` = cell_spec(`Other`, "latex", background = case_when(`Other_sig` == "HIGHER" ~ "#C3C3FF", `Other_sig` == "LOWER" ~ "#00A3A3", TRUE ~ "#FFFFFF")),
`Permanently retired from work` = cell_spec(`Permanently retired from work`, "latex", background = case_when(`Permanently retired from work_sig` == "HIGHER" ~ "#C3C3FF", `Permanently retired from work_sig` == "LOWER" ~ "#00A3A3", TRUE ~ "#FFFFFF"))) %>%
        select(!tidyselect::all_of(significance_column_names)) %>%
        kable("latex", escape = FALSE, booktabs = T)
} else {
asis_output("### There is no data to show for this table within the specified parameters, or there is no data to compare with.")
}
```
## Table 11.4: Whether provided unpaid help to organisations or groups in the last 12 months by net annual household income
### Column percentages, Adults

### `r main_table_title`

```{r eval=(eval_comparison == FALSE)}
if (!is.null(Table_11.4)) {
Table_11.4 %>%
kable("latex", escape = TRUE, booktabs = T)
 } else {
        asis_output("### There is no data to show for this table within the specified parameters")
      }
```

```{r eval=eval_comparison}
if (!is.null(Table_11.4)) {
if (length(grep("_2", colnames(Table_11.4))) > 0) {
colnames(Table_11.4) <- gsub("%", "\\\\%", colnames(Table_11.4))
main_column_names <- colnames(Table_11.4)[!grepl("_2", colnames(Table_11.4))]
significance_column_names <- colnames(Table_11.4)[grepl("_sig", colnames(Table_11.4))]

Table_11.4 %>% select(tidyselect::all_of(main_column_names)) %>%
mutate(`Up to £15,000` = cell_spec(`Up to £15,000`, "latex", background = case_when(`Up to £15,000_sig` == "HIGHER" ~ "#00A3A3", `Up to £15,000_sig` == "LOWER" ~ "#C3C3FF", TRUE ~ "#FFFFFF")),
`£15,001 to £30,000` = cell_spec(`£15,001 to £30,000`, "latex", background = case_when(`£15,001 to £30,000_sig` == "HIGHER" ~ "#00A3A3", `£15,001 to £30,000_sig` == "LOWER" ~ "#C3C3FF", TRUE ~ "#FFFFFF")),
`Over £30,000` = cell_spec(`Over £30,000`, "latex", background = case_when(`Over £30,000_sig` == "HIGHER" ~ "#00A3A3", `Over £30,000_sig` == "LOWER" ~ "#C3C3FF", TRUE ~ "#FFFFFF"))

) %>%
select(!tidyselect::all_of(significance_column_names)) %>%
kable("latex", escape = FALSE, booktabs = T)
} else {
Table_11.4 %>%
kable("latex", escape = TRUE, booktabs = T)
}
} else {
  asis_output("### There is no data to show for this table within the specified parameters, or there is no data to compare with.")
}
```
```{r eval=eval_comparison}
asis_output(paste0("### ", comparison_table_title))
```

```{r eval=eval_comparison}
if (!is.null(Table_11.4) && length(grep("_2", colnames(Table_11.4))) > 0) {
comparison_column_names <- colnames(Table_11.4)[grepl("_2", colnames(Table_11.4))]
comparison_rename_column_names <- gsub("_2", "", comparison_column_names)

Table_11.4 %>% select(tidyselect::all_of(colnames(Table_11.4)[!colnames(Table_11.4) %in% comparison_rename_column_names])) %>%
rename_at(comparison_column_names, ~ comparison_rename_column_names) %>%
mutate(`Up to £15,000` = cell_spec(`Up to £15,000`, "latex", background = case_when(`Up to £15,000_sig` == "HIGHER" ~ "#C3C3FF", `Up to £15,000_sig` == "LOWER" ~ "#00A3A3", TRUE ~ "#FFFFFF")),
`£15,001 to £30,000` = cell_spec(`£15,001 to £30,000`, "latex", background = case_when(`£15,001 to £30,000_sig` == "HIGHER" ~ "#C3C3FF", `£15,001 to £30,000_sig` == "LOWER" ~ "#00A3A3", TRUE ~ "#FFFFFF")),
`Over £30,000` = cell_spec(`Over £30,000`, "latex", background = case_when(`Over £30,000_sig` == "HIGHER" ~ "#C3C3FF", `Over £30,000_sig` == "LOWER" ~ "#00A3A3", TRUE ~ "#FFFFFF"))) %>%
        select(!tidyselect::all_of(significance_column_names)) %>%
        kable("latex", escape = FALSE, booktabs = T)
} else {
asis_output("### There is no data to show for this table within the specified parameters, or there is no data to compare with.")
}
```
