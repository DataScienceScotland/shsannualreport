---
params:
  report_title: ""
  author: ""
  date: ""
  local_authority: ""
  year: ""
  topic_data: ""
  comparison_type: ""
  comparator: ""
title: "`r params$report_title`"
author: "`r params$author`"
date: "`r params$date`"
output:
  pdf_document:
    toc: yes
    fig_caption: false
header-includes:
    - \hypersetup{colorlinks=true, linkcolor = black, urlcolor = [RGB]{0, 163, 163}}
    - \usepackage{titling}
    - \pretitle{\begin{center}
      \includegraphics[width=2in,height=2in]{../www/new_logo.png}\LARGE\\}
    - \posttitle{\end{center}}
    - \renewcommand{\familydefault}{\sfdefault}
classoption: landscape
fontsize: 10pt
papersize: a4
geometry: margin=1.5cm
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo=FALSE)
options(tinytex.verbose = TRUE)

library(knitr)
library(dplyr)
library(kableExtra)
library(png)
library(tidyselect)

local_authority <- params$local_authority
year <- params$year
topic_data <- params$topic_data
comparison_type <- params$comparison_type
comparator <- params$comparator


Figure_9.1_Table_9.1 <- topic_data[[1]]

Table_9.2 <- topic_data[[2]]

Table_9.3 <- topic_data[[3]]

Table_9.4 <- topic_data[[4]]

Table_9.5 <- topic_data[[5]]

Figure_9.2 <- topic_data[[6]]

Table_9.6 <- topic_data[[7]]

Table_9.7 <- topic_data[[8]]

Figure_9.3 <- topic_data[[9]]

Figure_9.4 <- topic_data[[10]]


main_table_title <- paste0(local_authority, ", ", year)

eval_comparison <- ifelse(comparison_type == "No comparison", FALSE, TRUE)

eval_comparison_time_series <- ifelse(comparison_type == "Year" | comparison_type == "No comparison", FALSE, TRUE)

comparison_table_title <- if (comparison_type == "Local Authority/Scotland") {
  paste0(comparator, ", ", year)
} else if (comparison_type == "Year") {
  paste0(local_authority, ", ", comparator)
} else {
  NULL
}

if (comparison_type == "Local Authority/Scotland") {

main_significance_key <- asis_output(paste0("```{=latex}
  $ \\color[RGB]{0, 163, 163} \\blacksquare $ Significantly greater than ", comparator, " (", year, ")  $ \\color[RGB]{195, 195, 255} \\blacksquare $ Significantly lower than ", comparator, " (", year, ")
  ```"))

comparison_significance_key <- asis_output(paste0("```{=latex}
  $ \\color[RGB]{0, 163, 163} \\blacksquare $ Significantly greater than ", local_authority, " (", year, ")  $ \\color[RGB]{195, 195, 255} \\blacksquare $ Significantly lower than ", local_authority, " (", year, ")
  ```"))

main_significance_key_time_series <- asis_output(paste0("```{=latex}
  $ \\color[RGB]{0, 163, 163} \\blacksquare $ Significantly greater than ", comparator, "  $ \\color[RGB]{195, 195, 255} \\blacksquare $ Significantly lower than ", comparator, "
  ```"))

comparison_significance_key_time_series <- asis_output(paste0("```{=latex}
  $ \\color[RGB]{0, 163, 163} \\blacksquare $ Significantly greater than ", local_authority, "  $ \\color[RGB]{195, 195, 255} \\blacksquare $ Significantly lower than ", local_authority, "
  ```"))


} else if (comparison_type == "Year") {

  main_significance_key <- asis_output(paste0("```{=latex}
  $ \\color[RGB]{0, 163, 163} \\blacksquare $ Significantly greater than ", local_authority, " (", comparator, ")  $ \\color[RGB]{195, 195, 255} \\blacksquare $ Significantly lower than ", local_authority, " (", comparator, ")
  ```"))

  comparison_significance_key <- asis_output(paste0("```{=latex}
  $ \\color[RGB]{0, 163, 163} \\blacksquare $ Significantly greater than ", local_authority, " (", year, ")  $ \\color[RGB]{195, 195, 255} \\blacksquare $ Significantly lower than ", local_authority, " (", year, ")
  ```"))

} else {

  main_significance_key <- ""

  comparison_significance_key <- ""
}

```

## Acknowledgements
The Scottish Government acknowledges and thanks the 10,530
people across Scotland who gave their time to take part in the
Scottish Household Survey 2018.
This report was produced by the Scottish Household Survey Project Team
at the Scottish Government.
We would also like to thank all the Scottish Government lead analysts who
contributed to the project.
Finally, special thanks to Ipsos MORI and their interviewers for continuous
and relentless efforts during the fieldwork.

\pagebreak

## Figure 9.1, Table 9.1: Percentage of people very or fairly satisfied with the quality of public services delivered (local health services, local schools and public transport) by year
### Column percentages, Adults
### Percentages reported for all three services combined are those for which an opinion was given. Respondents could express no opinion for up to two of the services
### [Another breakdown of this table can be found at the Scottish Surveys Core Questions](https://www2.gov.scot/Topics/Statistics/About/Surveys/SSCQ)

### `r local_authority`

```{r eval=(eval_comparison_time_series == FALSE)}
if (!is.null(Figure_9.1_Table_9.1)) {
Figure_9.1_Table_9.1 %>%
kable("latex", col.names = gsub("blank", "", colnames(Figure_9.1_Table_9.1)), escape = TRUE, booktabs = T)
 } else {
        asis_output("### There is no data to show for this table within the specified parameters")
      }
```

```{r eval=eval_comparison_time_series}
if (!is.null(Figure_9.1_Table_9.1)) {
if (length(grep("_2", colnames(Figure_9.1_Table_9.1))) > 0) {
colnames(Figure_9.1_Table_9.1) <- gsub("%", "\\\\%", colnames(Figure_9.1_Table_9.1))
main_column_names <- colnames(Figure_9.1_Table_9.1)[!grepl("_2", colnames(Figure_9.1_Table_9.1))]
significance_column_names <- colnames(Figure_9.1_Table_9.1)[grepl("_sig", colnames(Figure_9.1_Table_9.1))]
presentation_column_names <-  main_column_names[!main_column_names %in% significance_column_names]

Figure_9.1_Table_9.1 %>% select(tidyselect::all_of(main_column_names)) %>%
mutate(`2007/2008` = cell_spec(`2007/2008`, "latex", background = case_when(`2007/2008_sig` == "HIGHER" ~ "#00A3A3", `2007/2008_sig` == "LOWER" ~ "#C3C3FF", TRUE ~ "#FFFFFF")),
`2009/2010` = cell_spec(`2009/2010`, "latex", background = case_when(`2009/2010_sig` == "HIGHER" ~ "#00A3A3", `2009/2010_sig` == "LOWER" ~ "#C3C3FF", TRUE ~ "#FFFFFF")),
`2011` = cell_spec(`2011`, "latex", background = case_when(`2011_sig` == "HIGHER" ~ "#00A3A3", `2011_sig` == "LOWER" ~ "#C3C3FF", TRUE ~ "#FFFFFF")),
`2012` = cell_spec(`2012`, "latex", background = case_when(`2012_sig` == "HIGHER" ~ "#00A3A3", `2012_sig` == "LOWER" ~ "#C3C3FF", TRUE ~ "#FFFFFF")),
`2013` = cell_spec(`2013`, "latex", background = case_when(`2013_sig` == "HIGHER" ~ "#00A3A3", `2013_sig` == "LOWER" ~ "#C3C3FF", TRUE ~ "#FFFFFF")),
`2014` = cell_spec(`2014`, "latex", background = case_when(`2014_sig` == "HIGHER" ~ "#00A3A3", `2014_sig` == "LOWER" ~ "#C3C3FF", TRUE ~ "#FFFFFF")),
`2015` = cell_spec(`2015`, "latex", background = case_when(`2015_sig` == "HIGHER" ~ "#00A3A3", `2015_sig` == "LOWER" ~ "#C3C3FF", TRUE ~ "#FFFFFF")),
`2016` = cell_spec(`2016`, "latex", background = case_when(`2016_sig` == "HIGHER" ~ "#00A3A3", `2016_sig` == "LOWER" ~ "#C3C3FF", TRUE ~ "#FFFFFF")),
`2017` = cell_spec(`2017`, "latex", background = case_when(`2017_sig` == "HIGHER" ~ "#00A3A3", `2017_sig` == "LOWER" ~ "#C3C3FF", TRUE ~ "#FFFFFF")),
`2018` = cell_spec(`2018`, "latex", background = case_when(`2018_sig` == "HIGHER" ~ "#00A3A3", `2018_sig` == "LOWER" ~ "#C3C3FF", TRUE ~ "#FFFFFF"))

) %>%
select(!tidyselect::all_of(significance_column_names)) %>%
kable("latex", col.names = gsub("blank", "", presentation_column_names), escape = FALSE, booktabs = T)
} else {
Figure_9.1_Table_9.1 %>%
kable("latex", col.names = gsub("blank", "", colnames(Figure_9.1_Table_9.1)), escape = TRUE, booktabs = T)
}
} else {
  asis_output("### There is no data to show for this table within the specified parameters.")
}
```
```{r eval=eval_comparison_time_series}
main_significance_key_time_series
```

```{r eval=eval_comparison_time_series}

asis_output(paste0("### ", comparator))
  
```

```{r eval=eval_comparison_time_series}
if (!is.null(Figure_9.1_Table_9.1) && length(grep("_2", colnames(Figure_9.1_Table_9.1))) > 0) {
comparison_column_names <- colnames(Figure_9.1_Table_9.1)[grepl("_2", colnames(Figure_9.1_Table_9.1))]
comparison_rename_column_names <- gsub("_2", "", comparison_column_names)

Figure_9.1_Table_9.1 %>% select(tidyselect::all_of(colnames(Figure_9.1_Table_9.1)[!colnames(Figure_9.1_Table_9.1) %in% comparison_rename_column_names])) %>%
rename_at(comparison_column_names, ~ comparison_rename_column_names) %>%
mutate(`2007/2008` = cell_spec(`2007/2008`, "latex", background = case_when(`2007/2008_sig` == "HIGHER" ~ "#C3C3FF", `2007/2008_sig` == "LOWER" ~ "#00A3A3", TRUE ~ "#FFFFFF")),
`2009/2010` = cell_spec(`2009/2010`, "latex", background = case_when(`2009/2010_sig` == "HIGHER" ~ "#C3C3FF", `2009/2010_sig` == "LOWER" ~ "#00A3A3", TRUE ~ "#FFFFFF")),
`2011` = cell_spec(`2011`, "latex", background = case_when(`2011_sig` == "HIGHER" ~ "#C3C3FF", `2011_sig` == "LOWER" ~ "#00A3A3", TRUE ~ "#FFFFFF")),
`2012` = cell_spec(`2012`, "latex", background = case_when(`2012_sig` == "HIGHER" ~ "#C3C3FF", `2012_sig` == "LOWER" ~ "#00A3A3", TRUE ~ "#FFFFFF")),
`2013` = cell_spec(`2013`, "latex", background = case_when(`2013_sig` == "HIGHER" ~ "#C3C3FF", `2013_sig` == "LOWER" ~ "#00A3A3", TRUE ~ "#FFFFFF")),
`2014` = cell_spec(`2014`, "latex", background = case_when(`2014_sig` == "HIGHER" ~ "#C3C3FF", `2014_sig` == "LOWER" ~ "#00A3A3", TRUE ~ "#FFFFFF")),
`2015` = cell_spec(`2015`, "latex", background = case_when(`2015_sig` == "HIGHER" ~ "#C3C3FF", `2015_sig` == "LOWER" ~ "#00A3A3", TRUE ~ "#FFFFFF")),
`2016` = cell_spec(`2016`, "latex", background = case_when(`2016_sig` == "HIGHER" ~ "#C3C3FF", `2016_sig` == "LOWER" ~ "#00A3A3", TRUE ~ "#FFFFFF")),
`2017` = cell_spec(`2017`, "latex", background = case_when(`2017_sig` == "HIGHER" ~ "#C3C3FF", `2017_sig` == "LOWER" ~ "#00A3A3", TRUE ~ "#FFFFFF")),
`2018` = cell_spec(`2018`, "latex", background = case_when(`2018_sig` == "HIGHER" ~ "#C3C3FF", `2018_sig` == "LOWER" ~ "#00A3A3", TRUE ~ "#FFFFFF"))) %>%
        select(!tidyselect::all_of(significance_column_names)) %>%
        kable("latex", col.names = gsub("blank", "", presentation_column_names), escape = FALSE, booktabs = T)
} else {
asis_output("### There is no data to show for this table within the specified parameters, or there is no data to compare with.")
}
```
```{r eval=eval_comparison_time_series}
comparison_significance_key_time_series
```
\pagebreak

## Table 9.2: Percentage of people very or fairly satisfied with the quality of public services delivered (local health services, local schools and public transport) by year
### Column percentages, Adults
### [Another breakdown of this table can be found at the Scottish Surveys Core Questions](https://www2.gov.scot/Topics/Statistics/About/Surveys/SSCQ)

### `r local_authority`

```{r eval=(eval_comparison_time_series == FALSE)}
if (!is.null(Table_9.2)) {
Table_9.2 %>%
kable("latex", col.names = gsub("blank", "", colnames(Table_9.2)), escape = TRUE, booktabs = T)
 } else {
        asis_output("### There is no data to show for this table within the specified parameters")
      }
```

```{r eval=eval_comparison_time_series}
if (!is.null(Table_9.2)) {
if (length(grep("_2", colnames(Table_9.2))) > 0) {
colnames(Table_9.2) <- gsub("%", "\\\\%", colnames(Table_9.2))
main_column_names <- colnames(Table_9.2)[!grepl("_2", colnames(Table_9.2))]
significance_column_names <- colnames(Table_9.2)[grepl("_sig", colnames(Table_9.2))]
presentation_column_names <-  main_column_names[!main_column_names %in% significance_column_names]

Table_9.2 %>% select(tidyselect::all_of(main_column_names)) %>%
mutate(`2007/2008` = cell_spec(`2007/2008`, "latex", background = case_when(`2007/2008_sig` == "HIGHER" ~ "#00A3A3", `2007/2008_sig` == "LOWER" ~ "#C3C3FF", TRUE ~ "#FFFFFF")),
`2009/2010` = cell_spec(`2009/2010`, "latex", background = case_when(`2009/2010_sig` == "HIGHER" ~ "#00A3A3", `2009/2010_sig` == "LOWER" ~ "#C3C3FF", TRUE ~ "#FFFFFF")),
`2011` = cell_spec(`2011`, "latex", background = case_when(`2011_sig` == "HIGHER" ~ "#00A3A3", `2011_sig` == "LOWER" ~ "#C3C3FF", TRUE ~ "#FFFFFF")),
`2012` = cell_spec(`2012`, "latex", background = case_when(`2012_sig` == "HIGHER" ~ "#00A3A3", `2012_sig` == "LOWER" ~ "#C3C3FF", TRUE ~ "#FFFFFF")),
`2013` = cell_spec(`2013`, "latex", background = case_when(`2013_sig` == "HIGHER" ~ "#00A3A3", `2013_sig` == "LOWER" ~ "#C3C3FF", TRUE ~ "#FFFFFF")),
`2014` = cell_spec(`2014`, "latex", background = case_when(`2014_sig` == "HIGHER" ~ "#00A3A3", `2014_sig` == "LOWER" ~ "#C3C3FF", TRUE ~ "#FFFFFF")),
`2015` = cell_spec(`2015`, "latex", background = case_when(`2015_sig` == "HIGHER" ~ "#00A3A3", `2015_sig` == "LOWER" ~ "#C3C3FF", TRUE ~ "#FFFFFF")),
`2016` = cell_spec(`2016`, "latex", background = case_when(`2016_sig` == "HIGHER" ~ "#00A3A3", `2016_sig` == "LOWER" ~ "#C3C3FF", TRUE ~ "#FFFFFF")),
`2017` = cell_spec(`2017`, "latex", background = case_when(`2017_sig` == "HIGHER" ~ "#00A3A3", `2017_sig` == "LOWER" ~ "#C3C3FF", TRUE ~ "#FFFFFF")),
`2018` = cell_spec(`2018`, "latex", background = case_when(`2018_sig` == "HIGHER" ~ "#00A3A3", `2018_sig` == "LOWER" ~ "#C3C3FF", TRUE ~ "#FFFFFF"))

) %>%
select(!tidyselect::all_of(significance_column_names)) %>%
kable("latex", col.names = gsub("blank", "", presentation_column_names), escape = FALSE, booktabs = T)
} else {
Table_9.2 %>%
kable("latex", col.names = gsub("blank", "", colnames(Table_9.2)), escape = TRUE, booktabs = T)
}
} else {
  asis_output("### There is no data to show for this table within the specified parameters.")
}
```
```{r eval=eval_comparison_time_series}
main_significance_key_time_series
```

```{r eval=eval_comparison_time_series}

asis_output(paste0("### ", comparator))
  
```

```{r eval=eval_comparison_time_series}
if (!is.null(Table_9.2) && length(grep("_2", colnames(Table_9.2))) > 0) {
comparison_column_names <- colnames(Table_9.2)[grepl("_2", colnames(Table_9.2))]
comparison_rename_column_names <- gsub("_2", "", comparison_column_names)

Table_9.2 %>% select(tidyselect::all_of(colnames(Table_9.2)[!colnames(Table_9.2) %in% comparison_rename_column_names])) %>%
rename_at(comparison_column_names, ~ comparison_rename_column_names) %>%
mutate(`2007/2008` = cell_spec(`2007/2008`, "latex", background = case_when(`2007/2008_sig` == "HIGHER" ~ "#C3C3FF", `2007/2008_sig` == "LOWER" ~ "#00A3A3", TRUE ~ "#FFFFFF")),
`2009/2010` = cell_spec(`2009/2010`, "latex", background = case_when(`2009/2010_sig` == "HIGHER" ~ "#C3C3FF", `2009/2010_sig` == "LOWER" ~ "#00A3A3", TRUE ~ "#FFFFFF")),
`2011` = cell_spec(`2011`, "latex", background = case_when(`2011_sig` == "HIGHER" ~ "#C3C3FF", `2011_sig` == "LOWER" ~ "#00A3A3", TRUE ~ "#FFFFFF")),
`2012` = cell_spec(`2012`, "latex", background = case_when(`2012_sig` == "HIGHER" ~ "#C3C3FF", `2012_sig` == "LOWER" ~ "#00A3A3", TRUE ~ "#FFFFFF")),
`2013` = cell_spec(`2013`, "latex", background = case_when(`2013_sig` == "HIGHER" ~ "#C3C3FF", `2013_sig` == "LOWER" ~ "#00A3A3", TRUE ~ "#FFFFFF")),
`2014` = cell_spec(`2014`, "latex", background = case_when(`2014_sig` == "HIGHER" ~ "#C3C3FF", `2014_sig` == "LOWER" ~ "#00A3A3", TRUE ~ "#FFFFFF")),
`2015` = cell_spec(`2015`, "latex", background = case_when(`2015_sig` == "HIGHER" ~ "#C3C3FF", `2015_sig` == "LOWER" ~ "#00A3A3", TRUE ~ "#FFFFFF")),
`2016` = cell_spec(`2016`, "latex", background = case_when(`2016_sig` == "HIGHER" ~ "#C3C3FF", `2016_sig` == "LOWER" ~ "#00A3A3", TRUE ~ "#FFFFFF")),
`2017` = cell_spec(`2017`, "latex", background = case_when(`2017_sig` == "HIGHER" ~ "#C3C3FF", `2017_sig` == "LOWER" ~ "#00A3A3", TRUE ~ "#FFFFFF")),
`2018` = cell_spec(`2018`, "latex", background = case_when(`2018_sig` == "HIGHER" ~ "#C3C3FF", `2018_sig` == "LOWER" ~ "#00A3A3", TRUE ~ "#FFFFFF"))) %>%
        select(!tidyselect::all_of(significance_column_names)) %>%
        kable("latex", col.names = gsub("blank", "", presentation_column_names), escape = FALSE, booktabs = T)
} else {
asis_output("### There is no data to show for this table within the specified parameters, or there is no data to compare with.")
}
```
```{r eval=eval_comparison_time_series}
comparison_significance_key_time_series
```
\pagebreak

## Table 9.3: Percentage of people very or fairly satisfied with the quality of public services delivered (local health services, local schools and public transport) by Urban Rural Classification
### Column percentages, Adults
### Percentages reported for all three services combined are those for which an opinion was given. Respondents could express no opinion for up to two of the services

### `r main_table_title`

```{r eval=(eval_comparison == FALSE)}
if (!is.null(Table_9.3)) {
Table_9.3 %>%
kable("latex", col.names = gsub("blank", "", colnames(Table_9.3)), escape = TRUE, booktabs = T)
 } else {
        asis_output("### There is no data to show for this table within the specified parameters")
      }
```

```{r eval=eval_comparison}
if (!is.null(Table_9.3)) {
if (length(grep("_2", colnames(Table_9.3))) > 0) {
colnames(Table_9.3) <- gsub("%", "\\\\%", colnames(Table_9.3))
main_column_names <- colnames(Table_9.3)[!grepl("_2", colnames(Table_9.3))]
significance_column_names <- colnames(Table_9.3)[grepl("_sig", colnames(Table_9.3))]
presentation_column_names <-  main_column_names[!main_column_names %in% significance_column_names]

Table_9.3 %>% select(tidyselect::all_of(main_column_names)) %>%
mutate(`Large urban areas` = cell_spec(`Large urban areas`, "latex", background = case_when(`Large urban areas_sig` == "HIGHER" ~ "#00A3A3", `Large urban areas_sig` == "LOWER" ~ "#C3C3FF", TRUE ~ "#FFFFFF")),
`Other urban areas` = cell_spec(`Other urban areas`, "latex", background = case_when(`Other urban areas_sig` == "HIGHER" ~ "#00A3A3", `Other urban areas_sig` == "LOWER" ~ "#C3C3FF", TRUE ~ "#FFFFFF")),
`Accessible small towns` = cell_spec(`Accessible small towns`, "latex", background = case_when(`Accessible small towns_sig` == "HIGHER" ~ "#00A3A3", `Accessible small towns_sig` == "LOWER" ~ "#C3C3FF", TRUE ~ "#FFFFFF")),
`Remote small towns` = cell_spec(`Remote small towns`, "latex", background = case_when(`Remote small towns_sig` == "HIGHER" ~ "#00A3A3", `Remote small towns_sig` == "LOWER" ~ "#C3C3FF", TRUE ~ "#FFFFFF")),
`Accessible rural` = cell_spec(`Accessible rural`, "latex", background = case_when(`Accessible rural_sig` == "HIGHER" ~ "#00A3A3", `Accessible rural_sig` == "LOWER" ~ "#C3C3FF", TRUE ~ "#FFFFFF")),
`Remote rural` = cell_spec(`Remote rural`, "latex", background = case_when(`Remote rural_sig` == "HIGHER" ~ "#00A3A3", `Remote rural_sig` == "LOWER" ~ "#C3C3FF", TRUE ~ "#FFFFFF"))

) %>%
select(!tidyselect::all_of(significance_column_names)) %>%
kable("latex", col.names = gsub("blank", "", presentation_column_names), escape = FALSE, booktabs = T)
} else {
Table_9.3 %>%
kable("latex", col.names = gsub("blank", "", colnames(Table_9.3)), escape = TRUE, booktabs = T)
}
} else {
  asis_output("### There is no data to show for this table within the specified parameters.")
}
```
```{r eval=eval_comparison}
main_significance_key
```

```{r eval=eval_comparison}

asis_output(paste0("### ", comparison_table_title))
  
```

```{r eval=eval_comparison}
if (!is.null(Table_9.3) && length(grep("_2", colnames(Table_9.3))) > 0) {
comparison_column_names <- colnames(Table_9.3)[grepl("_2", colnames(Table_9.3))]
comparison_rename_column_names <- gsub("_2", "", comparison_column_names)

Table_9.3 %>% select(tidyselect::all_of(colnames(Table_9.3)[!colnames(Table_9.3) %in% comparison_rename_column_names])) %>%
rename_at(comparison_column_names, ~ comparison_rename_column_names) %>%
mutate(`Large urban areas` = cell_spec(`Large urban areas`, "latex", background = case_when(`Large urban areas_sig` == "HIGHER" ~ "#C3C3FF", `Large urban areas_sig` == "LOWER" ~ "#00A3A3", TRUE ~ "#FFFFFF")),
`Other urban areas` = cell_spec(`Other urban areas`, "latex", background = case_when(`Other urban areas_sig` == "HIGHER" ~ "#C3C3FF", `Other urban areas_sig` == "LOWER" ~ "#00A3A3", TRUE ~ "#FFFFFF")),
`Accessible small towns` = cell_spec(`Accessible small towns`, "latex", background = case_when(`Accessible small towns_sig` == "HIGHER" ~ "#C3C3FF", `Accessible small towns_sig` == "LOWER" ~ "#00A3A3", TRUE ~ "#FFFFFF")),
`Remote small towns` = cell_spec(`Remote small towns`, "latex", background = case_when(`Remote small towns_sig` == "HIGHER" ~ "#C3C3FF", `Remote small towns_sig` == "LOWER" ~ "#00A3A3", TRUE ~ "#FFFFFF")),
`Accessible rural` = cell_spec(`Accessible rural`, "latex", background = case_when(`Accessible rural_sig` == "HIGHER" ~ "#C3C3FF", `Accessible rural_sig` == "LOWER" ~ "#00A3A3", TRUE ~ "#FFFFFF")),
`Remote rural` = cell_spec(`Remote rural`, "latex", background = case_when(`Remote rural_sig` == "HIGHER" ~ "#C3C3FF", `Remote rural_sig` == "LOWER" ~ "#00A3A3", TRUE ~ "#FFFFFF"))) %>%
        select(!tidyselect::all_of(significance_column_names)) %>%
        kable("latex", col.names = gsub("blank", "", presentation_column_names), escape = FALSE, booktabs = T)
} else {
asis_output("### There is no data to show for this table within the specified parameters, or there is no data to compare with.")
}
```
```{r eval=eval_comparison}
comparison_significance_key
```
\pagebreak

## Table 9.4: Percentage of people very or fairly satisfied with the quality of public services delivered (local health services, local schools and public transport) by Scottish Index of Multiple Deprivation
### Column percentages, Adults

### `r main_table_title`

```{r eval=(eval_comparison == FALSE)}
if (!is.null(Table_9.4)) {
Table_9.4 %>%
kable("latex", col.names = gsub("blank", "", colnames(Table_9.4)), escape = TRUE, booktabs = T)
 } else {
        asis_output("### There is no data to show for this table within the specified parameters")
      }
```

```{r eval=eval_comparison}
if (!is.null(Table_9.4)) {
if (length(grep("_2", colnames(Table_9.4))) > 0) {
colnames(Table_9.4) <- gsub("%", "\\\\%", colnames(Table_9.4))
main_column_names <- colnames(Table_9.4)[!grepl("_2", colnames(Table_9.4))]
significance_column_names <- colnames(Table_9.4)[grepl("_sig", colnames(Table_9.4))]
presentation_column_names <-  main_column_names[!main_column_names %in% significance_column_names]

Table_9.4 %>% select(tidyselect::all_of(main_column_names)) %>%
mutate(`1 - 20\\% most deprived` = cell_spec(`1 - 20\\% most deprived`, "latex", background = case_when(`1 - 20\\% most deprived_sig` == "HIGHER" ~ "#00A3A3", `1 - 20\\% most deprived_sig` == "LOWER" ~ "#C3C3FF", TRUE ~ "#FFFFFF")),
`2` = cell_spec(`2`, "latex", background = case_when(`2_sig` == "HIGHER" ~ "#00A3A3", `2_sig` == "LOWER" ~ "#C3C3FF", TRUE ~ "#FFFFFF")),
`3` = cell_spec(`3`, "latex", background = case_when(`3_sig` == "HIGHER" ~ "#00A3A3", `3_sig` == "LOWER" ~ "#C3C3FF", TRUE ~ "#FFFFFF")),
`4` = cell_spec(`4`, "latex", background = case_when(`4_sig` == "HIGHER" ~ "#00A3A3", `4_sig` == "LOWER" ~ "#C3C3FF", TRUE ~ "#FFFFFF")),
`5 - 20\\% least deprived` = cell_spec(`5 - 20\\% least deprived`, "latex", background = case_when(`5 - 20\\% least deprived_sig` == "HIGHER" ~ "#00A3A3", `5 - 20\\% least deprived_sig` == "LOWER" ~ "#C3C3FF", TRUE ~ "#FFFFFF"))

) %>%
select(!tidyselect::all_of(significance_column_names)) %>%
kable("latex", col.names = gsub("blank", "", presentation_column_names), escape = FALSE, booktabs = T)
} else {
Table_9.4 %>%
kable("latex", col.names = gsub("blank", "", colnames(Table_9.4)), escape = TRUE, booktabs = T)
}
} else {
  asis_output("### There is no data to show for this table within the specified parameters.")
}
```
```{r eval=eval_comparison}
main_significance_key
```

```{r eval=eval_comparison}

asis_output(paste0("### ", comparison_table_title))
  
```

```{r eval=eval_comparison}
if (!is.null(Table_9.4) && length(grep("_2", colnames(Table_9.4))) > 0) {
comparison_column_names <- colnames(Table_9.4)[grepl("_2", colnames(Table_9.4))]
comparison_rename_column_names <- gsub("_2", "", comparison_column_names)

Table_9.4 %>% select(tidyselect::all_of(colnames(Table_9.4)[!colnames(Table_9.4) %in% comparison_rename_column_names])) %>%
rename_at(comparison_column_names, ~ comparison_rename_column_names) %>%
mutate(`1 - 20\\% most deprived` = cell_spec(`1 - 20\\% most deprived`, "latex", background = case_when(`1 - 20\\% most deprived_sig` == "HIGHER" ~ "#C3C3FF", `1 - 20\\% most deprived_sig` == "LOWER" ~ "#00A3A3", TRUE ~ "#FFFFFF")),
`2` = cell_spec(`2`, "latex", background = case_when(`2_sig` == "HIGHER" ~ "#C3C3FF", `2_sig` == "LOWER" ~ "#00A3A3", TRUE ~ "#FFFFFF")),
`3` = cell_spec(`3`, "latex", background = case_when(`3_sig` == "HIGHER" ~ "#C3C3FF", `3_sig` == "LOWER" ~ "#00A3A3", TRUE ~ "#FFFFFF")),
`4` = cell_spec(`4`, "latex", background = case_when(`4_sig` == "HIGHER" ~ "#C3C3FF", `4_sig` == "LOWER" ~ "#00A3A3", TRUE ~ "#FFFFFF")),
`5 - 20\\% least deprived` = cell_spec(`5 - 20\\% least deprived`, "latex", background = case_when(`5 - 20\\% least deprived_sig` == "HIGHER" ~ "#C3C3FF", `5 - 20\\% least deprived_sig` == "LOWER" ~ "#00A3A3", TRUE ~ "#FFFFFF"))) %>%
        select(!tidyselect::all_of(significance_column_names)) %>%
        kable("latex", col.names = gsub("blank", "", presentation_column_names), escape = FALSE, booktabs = T)
} else {
asis_output("### There is no data to show for this table within the specified parameters, or there is no data to compare with.")
}
```
```{r eval=eval_comparison}
comparison_significance_key
```
\pagebreak

## Table 9.5: Percentage of service users very or fairly satisfied with the quality of public services delivered (local health services, local schools and public transport) by year
### Column percentages, Adults
### User of Local health services not available prior to 2017. Users of Local schools identified by whether there is a school child present in the household. Users of Public transport identified by whether the respondent has used a bus or train within the last month

### `r local_authority`

```{r eval=(eval_comparison_time_series == FALSE)}
if (!is.null(Table_9.5)) {
Table_9.5 %>%
kable("latex", col.names = gsub("blank", "", colnames(Table_9.5)), escape = TRUE, booktabs = T)
 } else {
        asis_output("### There is no data to show for this table within the specified parameters")
      }
```

```{r eval=eval_comparison_time_series}
if (!is.null(Table_9.5)) {
if (length(grep("_2", colnames(Table_9.5))) > 0) {
colnames(Table_9.5) <- gsub("%", "\\\\%", colnames(Table_9.5))
main_column_names <- colnames(Table_9.5)[!grepl("_2", colnames(Table_9.5))]
significance_column_names <- colnames(Table_9.5)[grepl("_sig", colnames(Table_9.5))]
presentation_column_names <-  main_column_names[!main_column_names %in% significance_column_names]

Table_9.5 %>% select(tidyselect::all_of(main_column_names)) %>%
mutate(`2007/2008` = cell_spec(`2007/2008`, "latex", background = case_when(`2007/2008_sig` == "HIGHER" ~ "#00A3A3", `2007/2008_sig` == "LOWER" ~ "#C3C3FF", TRUE ~ "#FFFFFF")),
`2009/2010` = cell_spec(`2009/2010`, "latex", background = case_when(`2009/2010_sig` == "HIGHER" ~ "#00A3A3", `2009/2010_sig` == "LOWER" ~ "#C3C3FF", TRUE ~ "#FFFFFF")),
`2011` = cell_spec(`2011`, "latex", background = case_when(`2011_sig` == "HIGHER" ~ "#00A3A3", `2011_sig` == "LOWER" ~ "#C3C3FF", TRUE ~ "#FFFFFF")),
`2012` = cell_spec(`2012`, "latex", background = case_when(`2012_sig` == "HIGHER" ~ "#00A3A3", `2012_sig` == "LOWER" ~ "#C3C3FF", TRUE ~ "#FFFFFF")),
`2013` = cell_spec(`2013`, "latex", background = case_when(`2013_sig` == "HIGHER" ~ "#00A3A3", `2013_sig` == "LOWER" ~ "#C3C3FF", TRUE ~ "#FFFFFF")),
`2014` = cell_spec(`2014`, "latex", background = case_when(`2014_sig` == "HIGHER" ~ "#00A3A3", `2014_sig` == "LOWER" ~ "#C3C3FF", TRUE ~ "#FFFFFF")),
`2015` = cell_spec(`2015`, "latex", background = case_when(`2015_sig` == "HIGHER" ~ "#00A3A3", `2015_sig` == "LOWER" ~ "#C3C3FF", TRUE ~ "#FFFFFF")),
`2016` = cell_spec(`2016`, "latex", background = case_when(`2016_sig` == "HIGHER" ~ "#00A3A3", `2016_sig` == "LOWER" ~ "#C3C3FF", TRUE ~ "#FFFFFF")),
`2017` = cell_spec(`2017`, "latex", background = case_when(`2017_sig` == "HIGHER" ~ "#00A3A3", `2017_sig` == "LOWER" ~ "#C3C3FF", TRUE ~ "#FFFFFF")),
`2018` = cell_spec(`2018`, "latex", background = case_when(`2018_sig` == "HIGHER" ~ "#00A3A3", `2018_sig` == "LOWER" ~ "#C3C3FF", TRUE ~ "#FFFFFF"))

) %>%
select(!tidyselect::all_of(significance_column_names)) %>%
kable("latex", col.names = gsub("blank", "", presentation_column_names), escape = FALSE, booktabs = T)
} else {
Table_9.5 %>%
kable("latex", col.names = gsub("blank", "", colnames(Table_9.5)), escape = TRUE, booktabs = T)
}
} else {
  asis_output("### There is no data to show for this table within the specified parameters.")
}
```
```{r eval=eval_comparison_time_series}
main_significance_key_time_series
```

```{r eval=eval_comparison_time_series}

asis_output(paste0("### ", comparator))
  
```

```{r eval=eval_comparison_time_series}
if (!is.null(Table_9.5) && length(grep("_2", colnames(Table_9.5))) > 0) {
comparison_column_names <- colnames(Table_9.5)[grepl("_2", colnames(Table_9.5))]
comparison_rename_column_names <- gsub("_2", "", comparison_column_names)

Table_9.5 %>% select(tidyselect::all_of(colnames(Table_9.5)[!colnames(Table_9.5) %in% comparison_rename_column_names])) %>%
rename_at(comparison_column_names, ~ comparison_rename_column_names) %>%
mutate(`2007/2008` = cell_spec(`2007/2008`, "latex", background = case_when(`2007/2008_sig` == "HIGHER" ~ "#C3C3FF", `2007/2008_sig` == "LOWER" ~ "#00A3A3", TRUE ~ "#FFFFFF")),
`2009/2010` = cell_spec(`2009/2010`, "latex", background = case_when(`2009/2010_sig` == "HIGHER" ~ "#C3C3FF", `2009/2010_sig` == "LOWER" ~ "#00A3A3", TRUE ~ "#FFFFFF")),
`2011` = cell_spec(`2011`, "latex", background = case_when(`2011_sig` == "HIGHER" ~ "#C3C3FF", `2011_sig` == "LOWER" ~ "#00A3A3", TRUE ~ "#FFFFFF")),
`2012` = cell_spec(`2012`, "latex", background = case_when(`2012_sig` == "HIGHER" ~ "#C3C3FF", `2012_sig` == "LOWER" ~ "#00A3A3", TRUE ~ "#FFFFFF")),
`2013` = cell_spec(`2013`, "latex", background = case_when(`2013_sig` == "HIGHER" ~ "#C3C3FF", `2013_sig` == "LOWER" ~ "#00A3A3", TRUE ~ "#FFFFFF")),
`2014` = cell_spec(`2014`, "latex", background = case_when(`2014_sig` == "HIGHER" ~ "#C3C3FF", `2014_sig` == "LOWER" ~ "#00A3A3", TRUE ~ "#FFFFFF")),
`2015` = cell_spec(`2015`, "latex", background = case_when(`2015_sig` == "HIGHER" ~ "#C3C3FF", `2015_sig` == "LOWER" ~ "#00A3A3", TRUE ~ "#FFFFFF")),
`2016` = cell_spec(`2016`, "latex", background = case_when(`2016_sig` == "HIGHER" ~ "#C3C3FF", `2016_sig` == "LOWER" ~ "#00A3A3", TRUE ~ "#FFFFFF")),
`2017` = cell_spec(`2017`, "latex", background = case_when(`2017_sig` == "HIGHER" ~ "#C3C3FF", `2017_sig` == "LOWER" ~ "#00A3A3", TRUE ~ "#FFFFFF")),
`2018` = cell_spec(`2018`, "latex", background = case_when(`2018_sig` == "HIGHER" ~ "#C3C3FF", `2018_sig` == "LOWER" ~ "#00A3A3", TRUE ~ "#FFFFFF"))) %>%
        select(!tidyselect::all_of(significance_column_names)) %>%
        kable("latex", col.names = gsub("blank", "", presentation_column_names), escape = FALSE, booktabs = T)
} else {
asis_output("### There is no data to show for this table within the specified parameters, or there is no data to compare with.")
}
```
```{r eval=eval_comparison_time_series}
comparison_significance_key_time_series
```
\pagebreak

## Figure 9.2: Percentage agreeing with various statements about local authority services and performances
### Column percentages, Adults

### `r local_authority`

```{r eval=(eval_comparison_time_series == FALSE)}
if (!is.null(Figure_9.2)) {
Figure_9.2 %>%
kable("latex", col.names = gsub("blank", "", colnames(Figure_9.2)), escape = TRUE, booktabs = T)
 } else {
        asis_output("### There is no data to show for this table within the specified parameters")
      }
```

```{r eval=eval_comparison_time_series}
if (!is.null(Figure_9.2)) {
if (length(grep("_2", colnames(Figure_9.2))) > 0) {
colnames(Figure_9.2) <- gsub("%", "\\\\%", colnames(Figure_9.2))
main_column_names <- colnames(Figure_9.2)[!grepl("_2", colnames(Figure_9.2))]
significance_column_names <- colnames(Figure_9.2)[grepl("_sig", colnames(Figure_9.2))]
presentation_column_names <-  main_column_names[!main_column_names %in% significance_column_names]

Figure_9.2 %>% select(tidyselect::all_of(main_column_names)) %>%
mutate(`2013` = cell_spec(`2013`, "latex", background = case_when(`2013_sig` == "HIGHER" ~ "#00A3A3", `2013_sig` == "LOWER" ~ "#C3C3FF", TRUE ~ "#FFFFFF")),
`2014` = cell_spec(`2014`, "latex", background = case_when(`2014_sig` == "HIGHER" ~ "#00A3A3", `2014_sig` == "LOWER" ~ "#C3C3FF", TRUE ~ "#FFFFFF")),
`2015` = cell_spec(`2015`, "latex", background = case_when(`2015_sig` == "HIGHER" ~ "#00A3A3", `2015_sig` == "LOWER" ~ "#C3C3FF", TRUE ~ "#FFFFFF")),
`2016` = cell_spec(`2016`, "latex", background = case_when(`2016_sig` == "HIGHER" ~ "#00A3A3", `2016_sig` == "LOWER" ~ "#C3C3FF", TRUE ~ "#FFFFFF")),
`2017` = cell_spec(`2017`, "latex", background = case_when(`2017_sig` == "HIGHER" ~ "#00A3A3", `2017_sig` == "LOWER" ~ "#C3C3FF", TRUE ~ "#FFFFFF")),
`2018` = cell_spec(`2018`, "latex", background = case_when(`2018_sig` == "HIGHER" ~ "#00A3A3", `2018_sig` == "LOWER" ~ "#C3C3FF", TRUE ~ "#FFFFFF"))

) %>%
select(!tidyselect::all_of(significance_column_names)) %>%
kable("latex", col.names = gsub("blank", "", presentation_column_names), escape = FALSE, booktabs = T)
} else {
Figure_9.2 %>%
kable("latex", col.names = gsub("blank", "", colnames(Figure_9.2)), escape = TRUE, booktabs = T)
}
} else {
  asis_output("### There is no data to show for this table within the specified parameters.")
}
```
```{r eval=eval_comparison_time_series}
main_significance_key_time_series
```

```{r eval=eval_comparison_time_series}

asis_output(paste0("### ", comparator))
  
```

```{r eval=eval_comparison_time_series}
if (!is.null(Figure_9.2) && length(grep("_2", colnames(Figure_9.2))) > 0) {
comparison_column_names <- colnames(Figure_9.2)[grepl("_2", colnames(Figure_9.2))]
comparison_rename_column_names <- gsub("_2", "", comparison_column_names)

Figure_9.2 %>% select(tidyselect::all_of(colnames(Figure_9.2)[!colnames(Figure_9.2) %in% comparison_rename_column_names])) %>%
rename_at(comparison_column_names, ~ comparison_rename_column_names) %>%
mutate(`2013` = cell_spec(`2013`, "latex", background = case_when(`2013_sig` == "HIGHER" ~ "#C3C3FF", `2013_sig` == "LOWER" ~ "#00A3A3", TRUE ~ "#FFFFFF")),
`2014` = cell_spec(`2014`, "latex", background = case_when(`2014_sig` == "HIGHER" ~ "#C3C3FF", `2014_sig` == "LOWER" ~ "#00A3A3", TRUE ~ "#FFFFFF")),
`2015` = cell_spec(`2015`, "latex", background = case_when(`2015_sig` == "HIGHER" ~ "#C3C3FF", `2015_sig` == "LOWER" ~ "#00A3A3", TRUE ~ "#FFFFFF")),
`2016` = cell_spec(`2016`, "latex", background = case_when(`2016_sig` == "HIGHER" ~ "#C3C3FF", `2016_sig` == "LOWER" ~ "#00A3A3", TRUE ~ "#FFFFFF")),
`2017` = cell_spec(`2017`, "latex", background = case_when(`2017_sig` == "HIGHER" ~ "#C3C3FF", `2017_sig` == "LOWER" ~ "#00A3A3", TRUE ~ "#FFFFFF")),
`2018` = cell_spec(`2018`, "latex", background = case_when(`2018_sig` == "HIGHER" ~ "#C3C3FF", `2018_sig` == "LOWER" ~ "#00A3A3", TRUE ~ "#FFFFFF"))) %>%
        select(!tidyselect::all_of(significance_column_names)) %>%
        kable("latex", col.names = gsub("blank", "", presentation_column_names), escape = FALSE, booktabs = T)
} else {
asis_output("### There is no data to show for this table within the specified parameters, or there is no data to compare with.")
}
```
```{r eval=eval_comparison_time_series}
comparison_significance_key_time_series
```
\pagebreak

## Table 9.6: Percentage of people who agree with the statement 'I can influence decisions affecting my local area' by year
### Column percentages, Adults

### `r local_authority`

```{r eval=(eval_comparison_time_series == FALSE)}
if (!is.null(Table_9.6)) {
Table_9.6 %>%
kable("latex", col.names = gsub("blank", "", colnames(Table_9.6)), escape = TRUE, booktabs = T)
 } else {
        asis_output("### There is no data to show for this table within the specified parameters")
      }
```

```{r eval=eval_comparison_time_series}
if (!is.null(Table_9.6)) {
if (length(grep("_2", colnames(Table_9.6))) > 0) {
colnames(Table_9.6) <- gsub("%", "\\\\%", colnames(Table_9.6))
main_column_names <- colnames(Table_9.6)[!grepl("_2", colnames(Table_9.6))]
significance_column_names <- colnames(Table_9.6)[grepl("_sig", colnames(Table_9.6))]
presentation_column_names <-  main_column_names[!main_column_names %in% significance_column_names]

Table_9.6 %>% select(tidyselect::all_of(main_column_names)) %>%
mutate(`2007/2008` = cell_spec(`2007/2008`, "latex", background = case_when(`2007/2008_sig` == "HIGHER" ~ "#00A3A3", `2007/2008_sig` == "LOWER" ~ "#C3C3FF", TRUE ~ "#FFFFFF")),
`2009/2010` = cell_spec(`2009/2010`, "latex", background = case_when(`2009/2010_sig` == "HIGHER" ~ "#00A3A3", `2009/2010_sig` == "LOWER" ~ "#C3C3FF", TRUE ~ "#FFFFFF")),
`2011` = cell_spec(`2011`, "latex", background = case_when(`2011_sig` == "HIGHER" ~ "#00A3A3", `2011_sig` == "LOWER" ~ "#C3C3FF", TRUE ~ "#FFFFFF")),
`2012` = cell_spec(`2012`, "latex", background = case_when(`2012_sig` == "HIGHER" ~ "#00A3A3", `2012_sig` == "LOWER" ~ "#C3C3FF", TRUE ~ "#FFFFFF")),
`2013` = cell_spec(`2013`, "latex", background = case_when(`2013_sig` == "HIGHER" ~ "#00A3A3", `2013_sig` == "LOWER" ~ "#C3C3FF", TRUE ~ "#FFFFFF")),
`2014` = cell_spec(`2014`, "latex", background = case_when(`2014_sig` == "HIGHER" ~ "#00A3A3", `2014_sig` == "LOWER" ~ "#C3C3FF", TRUE ~ "#FFFFFF")),
`2015` = cell_spec(`2015`, "latex", background = case_when(`2015_sig` == "HIGHER" ~ "#00A3A3", `2015_sig` == "LOWER" ~ "#C3C3FF", TRUE ~ "#FFFFFF")),
`2016` = cell_spec(`2016`, "latex", background = case_when(`2016_sig` == "HIGHER" ~ "#00A3A3", `2016_sig` == "LOWER" ~ "#C3C3FF", TRUE ~ "#FFFFFF")),
`2017` = cell_spec(`2017`, "latex", background = case_when(`2017_sig` == "HIGHER" ~ "#00A3A3", `2017_sig` == "LOWER" ~ "#C3C3FF", TRUE ~ "#FFFFFF")),
`2018` = cell_spec(`2018`, "latex", background = case_when(`2018_sig` == "HIGHER" ~ "#00A3A3", `2018_sig` == "LOWER" ~ "#C3C3FF", TRUE ~ "#FFFFFF"))

) %>%
select(!tidyselect::all_of(significance_column_names)) %>%
kable("latex", col.names = gsub("blank", "", presentation_column_names), escape = FALSE, booktabs = T)
} else {
Table_9.6 %>%
kable("latex", col.names = gsub("blank", "", colnames(Table_9.6)), escape = TRUE, booktabs = T)
}
} else {
  asis_output("### There is no data to show for this table within the specified parameters.")
}
```
```{r eval=eval_comparison_time_series}
main_significance_key_time_series
```

```{r eval=eval_comparison_time_series}

asis_output(paste0("### ", comparator))
  
```

```{r eval=eval_comparison_time_series}
if (!is.null(Table_9.6) && length(grep("_2", colnames(Table_9.6))) > 0) {
comparison_column_names <- colnames(Table_9.6)[grepl("_2", colnames(Table_9.6))]
comparison_rename_column_names <- gsub("_2", "", comparison_column_names)

Table_9.6 %>% select(tidyselect::all_of(colnames(Table_9.6)[!colnames(Table_9.6) %in% comparison_rename_column_names])) %>%
rename_at(comparison_column_names, ~ comparison_rename_column_names) %>%
mutate(`2007/2008` = cell_spec(`2007/2008`, "latex", background = case_when(`2007/2008_sig` == "HIGHER" ~ "#C3C3FF", `2007/2008_sig` == "LOWER" ~ "#00A3A3", TRUE ~ "#FFFFFF")),
`2009/2010` = cell_spec(`2009/2010`, "latex", background = case_when(`2009/2010_sig` == "HIGHER" ~ "#C3C3FF", `2009/2010_sig` == "LOWER" ~ "#00A3A3", TRUE ~ "#FFFFFF")),
`2011` = cell_spec(`2011`, "latex", background = case_when(`2011_sig` == "HIGHER" ~ "#C3C3FF", `2011_sig` == "LOWER" ~ "#00A3A3", TRUE ~ "#FFFFFF")),
`2012` = cell_spec(`2012`, "latex", background = case_when(`2012_sig` == "HIGHER" ~ "#C3C3FF", `2012_sig` == "LOWER" ~ "#00A3A3", TRUE ~ "#FFFFFF")),
`2013` = cell_spec(`2013`, "latex", background = case_when(`2013_sig` == "HIGHER" ~ "#C3C3FF", `2013_sig` == "LOWER" ~ "#00A3A3", TRUE ~ "#FFFFFF")),
`2014` = cell_spec(`2014`, "latex", background = case_when(`2014_sig` == "HIGHER" ~ "#C3C3FF", `2014_sig` == "LOWER" ~ "#00A3A3", TRUE ~ "#FFFFFF")),
`2015` = cell_spec(`2015`, "latex", background = case_when(`2015_sig` == "HIGHER" ~ "#C3C3FF", `2015_sig` == "LOWER" ~ "#00A3A3", TRUE ~ "#FFFFFF")),
`2016` = cell_spec(`2016`, "latex", background = case_when(`2016_sig` == "HIGHER" ~ "#C3C3FF", `2016_sig` == "LOWER" ~ "#00A3A3", TRUE ~ "#FFFFFF")),
`2017` = cell_spec(`2017`, "latex", background = case_when(`2017_sig` == "HIGHER" ~ "#C3C3FF", `2017_sig` == "LOWER" ~ "#00A3A3", TRUE ~ "#FFFFFF")),
`2018` = cell_spec(`2018`, "latex", background = case_when(`2018_sig` == "HIGHER" ~ "#C3C3FF", `2018_sig` == "LOWER" ~ "#00A3A3", TRUE ~ "#FFFFFF"))) %>%
        select(!tidyselect::all_of(significance_column_names)) %>%
        kable("latex", col.names = gsub("blank", "", presentation_column_names), escape = FALSE, booktabs = T)
} else {
asis_output("### There is no data to show for this table within the specified parameters, or there is no data to compare with.")
}
```
```{r eval=eval_comparison_time_series}
comparison_significance_key_time_series
```
\pagebreak

## Table 9.7: Percentage agreeing with various statements about local council services by year
### Column percentages, Adults

### `r local_authority`

```{r eval=(eval_comparison_time_series == FALSE)}
if (!is.null(Table_9.7)) {
Table_9.7 %>%
kable("latex", col.names = gsub("blank", "", colnames(Table_9.7)), escape = TRUE, booktabs = T)
 } else {
        asis_output("### There is no data to show for this table within the specified parameters")
      }
```

```{r eval=eval_comparison_time_series}
if (!is.null(Table_9.7)) {
if (length(grep("_2", colnames(Table_9.7))) > 0) {
colnames(Table_9.7) <- gsub("%", "\\\\%", colnames(Table_9.7))
main_column_names <- colnames(Table_9.7)[!grepl("_2", colnames(Table_9.7))]
significance_column_names <- colnames(Table_9.7)[grepl("_sig", colnames(Table_9.7))]
presentation_column_names <-  main_column_names[!main_column_names %in% significance_column_names]

Table_9.7 %>% select(tidyselect::all_of(main_column_names)) %>%
mutate(`2007/2008` = cell_spec(`2007/2008`, "latex", background = case_when(`2007/2008_sig` == "HIGHER" ~ "#00A3A3", `2007/2008_sig` == "LOWER" ~ "#C3C3FF", TRUE ~ "#FFFFFF")),
`2009/2010` = cell_spec(`2009/2010`, "latex", background = case_when(`2009/2010_sig` == "HIGHER" ~ "#00A3A3", `2009/2010_sig` == "LOWER" ~ "#C3C3FF", TRUE ~ "#FFFFFF")),
`2011` = cell_spec(`2011`, "latex", background = case_when(`2011_sig` == "HIGHER" ~ "#00A3A3", `2011_sig` == "LOWER" ~ "#C3C3FF", TRUE ~ "#FFFFFF")),
`2012` = cell_spec(`2012`, "latex", background = case_when(`2012_sig` == "HIGHER" ~ "#00A3A3", `2012_sig` == "LOWER" ~ "#C3C3FF", TRUE ~ "#FFFFFF")),
`2013` = cell_spec(`2013`, "latex", background = case_when(`2013_sig` == "HIGHER" ~ "#00A3A3", `2013_sig` == "LOWER" ~ "#C3C3FF", TRUE ~ "#FFFFFF")),
`2014` = cell_spec(`2014`, "latex", background = case_when(`2014_sig` == "HIGHER" ~ "#00A3A3", `2014_sig` == "LOWER" ~ "#C3C3FF", TRUE ~ "#FFFFFF")),
`2015` = cell_spec(`2015`, "latex", background = case_when(`2015_sig` == "HIGHER" ~ "#00A3A3", `2015_sig` == "LOWER" ~ "#C3C3FF", TRUE ~ "#FFFFFF")),
`2016` = cell_spec(`2016`, "latex", background = case_when(`2016_sig` == "HIGHER" ~ "#00A3A3", `2016_sig` == "LOWER" ~ "#C3C3FF", TRUE ~ "#FFFFFF")),
`2017` = cell_spec(`2017`, "latex", background = case_when(`2017_sig` == "HIGHER" ~ "#00A3A3", `2017_sig` == "LOWER" ~ "#C3C3FF", TRUE ~ "#FFFFFF")),
`2018` = cell_spec(`2018`, "latex", background = case_when(`2018_sig` == "HIGHER" ~ "#00A3A3", `2018_sig` == "LOWER" ~ "#C3C3FF", TRUE ~ "#FFFFFF"))

) %>%
select(!tidyselect::all_of(significance_column_names)) %>%
kable("latex", col.names = gsub("blank", "", presentation_column_names), escape = FALSE, booktabs = T)
} else {
Table_9.7 %>%
kable("latex", col.names = gsub("blank", "", colnames(Table_9.7)), escape = TRUE, booktabs = T)
}
} else {
  asis_output("### There is no data to show for this table within the specified parameters.")
}
```
```{r eval=eval_comparison_time_series}
main_significance_key_time_series
```

```{r eval=eval_comparison_time_series}

asis_output(paste0("### ", comparator))
  
```

```{r eval=eval_comparison_time_series}
if (!is.null(Table_9.7) && length(grep("_2", colnames(Table_9.7))) > 0) {
comparison_column_names <- colnames(Table_9.7)[grepl("_2", colnames(Table_9.7))]
comparison_rename_column_names <- gsub("_2", "", comparison_column_names)

Table_9.7 %>% select(tidyselect::all_of(colnames(Table_9.7)[!colnames(Table_9.7) %in% comparison_rename_column_names])) %>%
rename_at(comparison_column_names, ~ comparison_rename_column_names) %>%
mutate(`2007/2008` = cell_spec(`2007/2008`, "latex", background = case_when(`2007/2008_sig` == "HIGHER" ~ "#C3C3FF", `2007/2008_sig` == "LOWER" ~ "#00A3A3", TRUE ~ "#FFFFFF")),
`2009/2010` = cell_spec(`2009/2010`, "latex", background = case_when(`2009/2010_sig` == "HIGHER" ~ "#C3C3FF", `2009/2010_sig` == "LOWER" ~ "#00A3A3", TRUE ~ "#FFFFFF")),
`2011` = cell_spec(`2011`, "latex", background = case_when(`2011_sig` == "HIGHER" ~ "#C3C3FF", `2011_sig` == "LOWER" ~ "#00A3A3", TRUE ~ "#FFFFFF")),
`2012` = cell_spec(`2012`, "latex", background = case_when(`2012_sig` == "HIGHER" ~ "#C3C3FF", `2012_sig` == "LOWER" ~ "#00A3A3", TRUE ~ "#FFFFFF")),
`2013` = cell_spec(`2013`, "latex", background = case_when(`2013_sig` == "HIGHER" ~ "#C3C3FF", `2013_sig` == "LOWER" ~ "#00A3A3", TRUE ~ "#FFFFFF")),
`2014` = cell_spec(`2014`, "latex", background = case_when(`2014_sig` == "HIGHER" ~ "#C3C3FF", `2014_sig` == "LOWER" ~ "#00A3A3", TRUE ~ "#FFFFFF")),
`2015` = cell_spec(`2015`, "latex", background = case_when(`2015_sig` == "HIGHER" ~ "#C3C3FF", `2015_sig` == "LOWER" ~ "#00A3A3", TRUE ~ "#FFFFFF")),
`2016` = cell_spec(`2016`, "latex", background = case_when(`2016_sig` == "HIGHER" ~ "#C3C3FF", `2016_sig` == "LOWER" ~ "#00A3A3", TRUE ~ "#FFFFFF")),
`2017` = cell_spec(`2017`, "latex", background = case_when(`2017_sig` == "HIGHER" ~ "#C3C3FF", `2017_sig` == "LOWER" ~ "#00A3A3", TRUE ~ "#FFFFFF")),
`2018` = cell_spec(`2018`, "latex", background = case_when(`2018_sig` == "HIGHER" ~ "#C3C3FF", `2018_sig` == "LOWER" ~ "#00A3A3", TRUE ~ "#FFFFFF"))) %>%
        select(!tidyselect::all_of(significance_column_names)) %>%
        kable("latex", col.names = gsub("blank", "", presentation_column_names), escape = FALSE, booktabs = T)
} else {
asis_output("### There is no data to show for this table within the specified parameters, or there is no data to compare with.")
}
```
```{r eval=eval_comparison_time_series}
comparison_significance_key_time_series
```
\pagebreak

## Figure 9.3: Percentage agreeing with various statements about local council services by age
### Column percentages, Adults
### Columns may not add up to 100 per cent as multiple responses were allowed

### `r main_table_title`

```{r eval=(eval_comparison == FALSE)}
if (!is.null(Figure_9.3)) {
Figure_9.3 %>%
kable("latex", col.names = gsub("blank", "", colnames(Figure_9.3)), escape = TRUE, booktabs = T)
 } else {
        asis_output("### There is no data to show for this table within the specified parameters")
      }
```

```{r eval=eval_comparison}
if (!is.null(Figure_9.3)) {
if (length(grep("_2", colnames(Figure_9.3))) > 0) {
colnames(Figure_9.3) <- gsub("%", "\\\\%", colnames(Figure_9.3))
main_column_names <- colnames(Figure_9.3)[!grepl("_2", colnames(Figure_9.3))]
significance_column_names <- colnames(Figure_9.3)[grepl("_sig", colnames(Figure_9.3))]
presentation_column_names <-  main_column_names[!main_column_names %in% significance_column_names]

Figure_9.3 %>% select(tidyselect::all_of(main_column_names)) %>%
mutate(`16-39` = cell_spec(`16-39`, "latex", background = case_when(`16-39_sig` == "HIGHER" ~ "#00A3A3", `16-39_sig` == "LOWER" ~ "#C3C3FF", TRUE ~ "#FFFFFF")),
`40-64` = cell_spec(`40-64`, "latex", background = case_when(`40-64_sig` == "HIGHER" ~ "#00A3A3", `40-64_sig` == "LOWER" ~ "#C3C3FF", TRUE ~ "#FFFFFF")),
`65+` = cell_spec(`65+`, "latex", background = case_when(`65+_sig` == "HIGHER" ~ "#00A3A3", `65+_sig` == "LOWER" ~ "#C3C3FF", TRUE ~ "#FFFFFF"))

) %>%
select(!tidyselect::all_of(significance_column_names)) %>%
kable("latex", col.names = gsub("blank", "", presentation_column_names), escape = FALSE, booktabs = T)
} else {
Figure_9.3 %>%
kable("latex", col.names = gsub("blank", "", colnames(Figure_9.3)), escape = TRUE, booktabs = T)
}
} else {
  asis_output("### There is no data to show for this table within the specified parameters.")
}
```
```{r eval=eval_comparison}
main_significance_key
```

```{r eval=eval_comparison}

asis_output(paste0("### ", comparison_table_title))
  
```

```{r eval=eval_comparison}
if (!is.null(Figure_9.3) && length(grep("_2", colnames(Figure_9.3))) > 0) {
comparison_column_names <- colnames(Figure_9.3)[grepl("_2", colnames(Figure_9.3))]
comparison_rename_column_names <- gsub("_2", "", comparison_column_names)

Figure_9.3 %>% select(tidyselect::all_of(colnames(Figure_9.3)[!colnames(Figure_9.3) %in% comparison_rename_column_names])) %>%
rename_at(comparison_column_names, ~ comparison_rename_column_names) %>%
mutate(`16-39` = cell_spec(`16-39`, "latex", background = case_when(`16-39_sig` == "HIGHER" ~ "#C3C3FF", `16-39_sig` == "LOWER" ~ "#00A3A3", TRUE ~ "#FFFFFF")),
`40-64` = cell_spec(`40-64`, "latex", background = case_when(`40-64_sig` == "HIGHER" ~ "#C3C3FF", `40-64_sig` == "LOWER" ~ "#00A3A3", TRUE ~ "#FFFFFF")),
`65+` = cell_spec(`65+`, "latex", background = case_when(`65+_sig` == "HIGHER" ~ "#C3C3FF", `65+_sig` == "LOWER" ~ "#00A3A3", TRUE ~ "#FFFFFF"))) %>%
        select(!tidyselect::all_of(significance_column_names)) %>%
        kable("latex", col.names = gsub("blank", "", presentation_column_names), escape = FALSE, booktabs = T)
} else {
asis_output("### There is no data to show for this table within the specified parameters, or there is no data to compare with.")
}
```
```{r eval=eval_comparison}
comparison_significance_key
```
\pagebreak

## Figure 9.4: Percentage agreeing with various statements about local council services by Scottish Index of Multiple Deprivation (SIMD)
### Column percentages, Adults
### Columns may not add up to 100 per cent as multiple responses were allowed

### `r main_table_title`

```{r eval=(eval_comparison == FALSE)}
if (!is.null(Figure_9.4)) {
Figure_9.4 %>%
kable("latex", col.names = gsub("blank", "", colnames(Figure_9.4)), escape = TRUE, booktabs = T)
 } else {
        asis_output("### There is no data to show for this table within the specified parameters")
      }
```

```{r eval=eval_comparison}
if (!is.null(Figure_9.4)) {
if (length(grep("_2", colnames(Figure_9.4))) > 0) {
colnames(Figure_9.4) <- gsub("%", "\\\\%", colnames(Figure_9.4))
main_column_names <- colnames(Figure_9.4)[!grepl("_2", colnames(Figure_9.4))]
significance_column_names <- colnames(Figure_9.4)[grepl("_sig", colnames(Figure_9.4))]
presentation_column_names <-  main_column_names[!main_column_names %in% significance_column_names]

Figure_9.4 %>% select(tidyselect::all_of(main_column_names)) %>%
mutate(`1 - 20\\% most deprived` = cell_spec(`1 - 20\\% most deprived`, "latex", background = case_when(`1 - 20\\% most deprived_sig` == "HIGHER" ~ "#00A3A3", `1 - 20\\% most deprived_sig` == "LOWER" ~ "#C3C3FF", TRUE ~ "#FFFFFF")),
`2` = cell_spec(`2`, "latex", background = case_when(`2_sig` == "HIGHER" ~ "#00A3A3", `2_sig` == "LOWER" ~ "#C3C3FF", TRUE ~ "#FFFFFF")),
`3` = cell_spec(`3`, "latex", background = case_when(`3_sig` == "HIGHER" ~ "#00A3A3", `3_sig` == "LOWER" ~ "#C3C3FF", TRUE ~ "#FFFFFF")),
`4` = cell_spec(`4`, "latex", background = case_when(`4_sig` == "HIGHER" ~ "#00A3A3", `4_sig` == "LOWER" ~ "#C3C3FF", TRUE ~ "#FFFFFF")),
`5 - 20\\% least deprived` = cell_spec(`5 - 20\\% least deprived`, "latex", background = case_when(`5 - 20\\% least deprived_sig` == "HIGHER" ~ "#00A3A3", `5 - 20\\% least deprived_sig` == "LOWER" ~ "#C3C3FF", TRUE ~ "#FFFFFF"))

) %>%
select(!tidyselect::all_of(significance_column_names)) %>%
kable("latex", col.names = gsub("blank", "", presentation_column_names), escape = FALSE, booktabs = T)
} else {
Figure_9.4 %>%
kable("latex", col.names = gsub("blank", "", colnames(Figure_9.4)), escape = TRUE, booktabs = T)
}
} else {
  asis_output("### There is no data to show for this table within the specified parameters.")
}
```
```{r eval=eval_comparison}
main_significance_key
```

```{r eval=eval_comparison}

asis_output(paste0("### ", comparison_table_title))
  
```

```{r eval=eval_comparison}
if (!is.null(Figure_9.4) && length(grep("_2", colnames(Figure_9.4))) > 0) {
comparison_column_names <- colnames(Figure_9.4)[grepl("_2", colnames(Figure_9.4))]
comparison_rename_column_names <- gsub("_2", "", comparison_column_names)

Figure_9.4 %>% select(tidyselect::all_of(colnames(Figure_9.4)[!colnames(Figure_9.4) %in% comparison_rename_column_names])) %>%
rename_at(comparison_column_names, ~ comparison_rename_column_names) %>%
mutate(`1 - 20\\% most deprived` = cell_spec(`1 - 20\\% most deprived`, "latex", background = case_when(`1 - 20\\% most deprived_sig` == "HIGHER" ~ "#C3C3FF", `1 - 20\\% most deprived_sig` == "LOWER" ~ "#00A3A3", TRUE ~ "#FFFFFF")),
`2` = cell_spec(`2`, "latex", background = case_when(`2_sig` == "HIGHER" ~ "#C3C3FF", `2_sig` == "LOWER" ~ "#00A3A3", TRUE ~ "#FFFFFF")),
`3` = cell_spec(`3`, "latex", background = case_when(`3_sig` == "HIGHER" ~ "#C3C3FF", `3_sig` == "LOWER" ~ "#00A3A3", TRUE ~ "#FFFFFF")),
`4` = cell_spec(`4`, "latex", background = case_when(`4_sig` == "HIGHER" ~ "#C3C3FF", `4_sig` == "LOWER" ~ "#00A3A3", TRUE ~ "#FFFFFF")),
`5 - 20\\% least deprived` = cell_spec(`5 - 20\\% least deprived`, "latex", background = case_when(`5 - 20\\% least deprived_sig` == "HIGHER" ~ "#C3C3FF", `5 - 20\\% least deprived_sig` == "LOWER" ~ "#00A3A3", TRUE ~ "#FFFFFF"))) %>%
        select(!tidyselect::all_of(significance_column_names)) %>%
        kable("latex", col.names = gsub("blank", "", presentation_column_names), escape = FALSE, booktabs = T)
} else {
asis_output("### There is no data to show for this table within the specified parameters, or there is no data to compare with.")
}
```
```{r eval=eval_comparison}
comparison_significance_key
```
\pagebreak

