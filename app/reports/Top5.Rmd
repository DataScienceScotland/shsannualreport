---
title: "Scotland's People Local Authority Tables"
output:
  pdf_document:
    toc: yes
    latex_engine: xelatex
    fig_caption: false
classoption: landscape
fontsize: 10pt
papersize: a4
geometry: margin=1.5cm
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo=FALSE)
options(tinytex.verbose = TRUE)

library(knitr)
library(dplyr)
library(kableExtra)
library(png)
library(tidyselect)

local_authority <- params$local_authority
year <- params$year
topic_data <- params$topic_data
comparison_type <- params$comparison_type
comparator <- params$comparator

Table_5.1_Figure_5.1 <- topic_data[[1]]
Table_5.2 <- topic_data[[2]]
Table_5.3_Figure_5.2 <- topic_data[[3]]
Figure_5.3 <- topic_data[[4]]
Figure_5.4 <- topic_data[[5]]
Figure_5.5 <- topic_data[[6]]
Figure_5.6 <- topic_data[[7]]
Table_5.4 <- topic_data[[8]]
Table_5.5 <- topic_data[[9]]
Figure_5.7 <- topic_data[[10]]
Figure_5.8 <- topic_data[[11]]

main_table_title <- paste0(local_authority, ", ", year)

eval_comparison <- ifelse(comparison_type == "No comparison", FALSE, TRUE)

eval_comparison_time_series <- ifelse(comparison_type == "Year" | comparison_type == "No comparison", FALSE, TRUE)

comparison_table_title <- if (comparison_type == "Local Authority") {
  paste0(comparator, ", ", year)
} else if (comparison_type == "Year") {
  paste0(local_authority, ", ", comparator)
} else {
  NULL
  }

```
```{r, out.height = "130pt", fig.show='hold', fig.align='center'}
knitr::include_graphics(c("../www/shs-logo.png", "../www/home_logo.png"))
```

## Acknowledgements
The Scottish Government acknowledges and thanks the 10,530
people across Scotland who gave their time to take part in the
Scottish Household Survey 2018.
This report was produced by the Scottish Household Survey Project Team
at the Scottish Government.
We would also like to thank all the Scottish Government lead analysts who
contributed to the project.
Finally, special thanks to Ipsos MORI and their interviewers for continuous
and relentless efforts during the fieldwork.

## Table 5.1, Figure 5.1: Highest level of qualifications held by adults aged 16 and over by year, 2007-2018
### Column percentages, Adults
### [Another breakdown of this table can be found at the Scottish Surveys Core Questions](https://www2.gov.scot/Topics/Statistics/About/Surveys/SSCQ)

### `r main_table_title`

```{r eval=(eval_comparison_time_series == FALSE)}
Table_5.1_Figure_5.1 %>%
kable("latex")
```

```{r eval=eval_comparison_time_series}
main_column_names <- colnames(Table_5.1_Figure_5.1)[!grepl("_2", colnames(Table_5.1_Figure_5.1))]
significance_column_names <- colnames(Table_5.1_Figure_5.1)[grepl("_sig", colnames(Table_5.1_Figure_5.1))]

Table_5.1_Figure_5.1 %>% select(tidyselect::all_of(main_column_names)) %>%
mutate(`1999/2000` = cell_spec(`1999/2000`, "latex", background = case_when(`1999/2000_sig` == "HIGHER" ~ "#00A3A3", `1999/2000_sig` == "LOWER" ~ "#C3C3FF", TRUE ~ "white")),
`2001/2002` = cell_spec(`2001/2002`, "latex", background = case_when(`2001/2002_sig` == "HIGHER" ~ "#00A3A3", `2001/2002_sig` == "LOWER" ~ "#C3C3FF", TRUE ~ "white")),
`2003/2004` = cell_spec(`2003/2004`, "latex", background = case_when(`2003/2004_sig` == "HIGHER" ~ "#00A3A3", `2003/2004_sig` == "LOWER" ~ "#C3C3FF", TRUE ~ "white")),
`2005/2006` = cell_spec(`2005/2006`, "latex", background = case_when(`2005/2006_sig` == "HIGHER" ~ "#00A3A3", `2005/2006_sig` == "LOWER" ~ "#C3C3FF", TRUE ~ "white")),
`2007/2008` = cell_spec(`2007/2008`, "latex", background = case_when(`2007/2008_sig` == "HIGHER" ~ "#00A3A3", `2007/2008_sig` == "LOWER" ~ "#C3C3FF", TRUE ~ "white")),
`2009/2010` = cell_spec(`2009/2010`, "latex", background = case_when(`2009/2010_sig` == "HIGHER" ~ "#00A3A3", `2009/2010_sig` == "LOWER" ~ "#C3C3FF", TRUE ~ "white")),
`2011` = cell_spec(`2011`, "latex", background = case_when(`2011_sig` == "HIGHER" ~ "#00A3A3", `2011_sig` == "LOWER" ~ "#C3C3FF", TRUE ~ "white")),
`2012` = cell_spec(`2012`, "latex", background = case_when(`2012_sig` == "HIGHER" ~ "#00A3A3", `2012_sig` == "LOWER" ~ "#C3C3FF", TRUE ~ "white")),
`2013` = cell_spec(`2013`, "latex", background = case_when(`2013_sig` == "HIGHER" ~ "#00A3A3", `2013_sig` == "LOWER" ~ "#C3C3FF", TRUE ~ "white")),
`2014` = cell_spec(`2014`, "latex", background = case_when(`2014_sig` == "HIGHER" ~ "#00A3A3", `2014_sig` == "LOWER" ~ "#C3C3FF", TRUE ~ "white")),
`2015` = cell_spec(`2015`, "latex", background = case_when(`2015_sig` == "HIGHER" ~ "#00A3A3", `2015_sig` == "LOWER" ~ "#C3C3FF", TRUE ~ "white")),
`2016` = cell_spec(`2016`, "latex", background = case_when(`2016_sig` == "HIGHER" ~ "#00A3A3", `2016_sig` == "LOWER" ~ "#C3C3FF", TRUE ~ "white")),
`2017` = cell_spec(`2017`, "latex", background = case_when(`2017_sig` == "HIGHER" ~ "#00A3A3", `2017_sig` == "LOWER" ~ "#C3C3FF", TRUE ~ "white")),
`2018` = cell_spec(`2018`, "latex", background = case_when(`2018_sig` == "HIGHER" ~ "#00A3A3", `2018_sig` == "LOWER" ~ "#C3C3FF", TRUE ~ "white"))

) %>%
select(!tidyselect::all_of(significance_column_names)) %>%
kable("latex", escape = FALSE)
```

```{r eval=eval_comparison_time_series}
asis_output(paste0("### ", comparison_table_title))
```

```{r eval=eval_comparison_time_series}
comparison_column_names <- colnames(Table_5.1_Figure_5.1)[grepl("_2", colnames(Table_5.1_Figure_5.1))]
comparison_rename_column_names <- gsub("_2", "", comparison_column_names)

Table_5.1_Figure_5.1 %>% select(tidyselect::all_of(colnames(Table_5.1_Figure_5.1)[!colnames(Table_5.1_Figure_5.1) %in% comparison_rename_column_names])) %>%
rename_at(comparison_column_names, ~ comparison_rename_column_names) %>%
mutate(`1999/2000` = cell_spec(`1999/2000`, "latex", background = case_when(`1999/2000_sig` == "HIGHER" ~ "#C3C3FF", `1999/2000_sig` == "LOWER" ~ "#00A3A3", TRUE ~ "white")),
`2001/2002` = cell_spec(`2001/2002`, "latex", background = case_when(`2001/2002_sig` == "HIGHER" ~ "#C3C3FF", `2001/2002_sig` == "LOWER" ~ "#00A3A3", TRUE ~ "white")),
`2003/2004` = cell_spec(`2003/2004`, "latex", background = case_when(`2003/2004_sig` == "HIGHER" ~ "#C3C3FF", `2003/2004_sig` == "LOWER" ~ "#00A3A3", TRUE ~ "white")),
`2005/2006` = cell_spec(`2005/2006`, "latex", background = case_when(`2005/2006_sig` == "HIGHER" ~ "#C3C3FF", `2005/2006_sig` == "LOWER" ~ "#00A3A3", TRUE ~ "white")),
`2007/2008` = cell_spec(`2007/2008`, "latex", background = case_when(`2007/2008_sig` == "HIGHER" ~ "#C3C3FF", `2007/2008_sig` == "LOWER" ~ "#00A3A3", TRUE ~ "white")),
`2009/2010` = cell_spec(`2009/2010`, "latex", background = case_when(`2009/2010_sig` == "HIGHER" ~ "#C3C3FF", `2009/2010_sig` == "LOWER" ~ "#00A3A3", TRUE ~ "white")),
`2011` = cell_spec(`2011`, "latex", background = case_when(`2011_sig` == "HIGHER" ~ "#C3C3FF", `2011_sig` == "LOWER" ~ "#00A3A3", TRUE ~ "white")),
`2012` = cell_spec(`2012`, "latex", background = case_when(`2012_sig` == "HIGHER" ~ "#C3C3FF", `2012_sig` == "LOWER" ~ "#00A3A3", TRUE ~ "white")),
`2013` = cell_spec(`2013`, "latex", background = case_when(`2013_sig` == "HIGHER" ~ "#C3C3FF", `2013_sig` == "LOWER" ~ "#00A3A3", TRUE ~ "white")),
`2014` = cell_spec(`2014`, "latex", background = case_when(`2014_sig` == "HIGHER" ~ "#C3C3FF", `2014_sig` == "LOWER" ~ "#00A3A3", TRUE ~ "white")),
`2015` = cell_spec(`2015`, "latex", background = case_when(`2015_sig` == "HIGHER" ~ "#C3C3FF", `2015_sig` == "LOWER" ~ "#00A3A3", TRUE ~ "white")),
`2016` = cell_spec(`2016`, "latex", background = case_when(`2016_sig` == "HIGHER" ~ "#C3C3FF", `2016_sig` == "LOWER" ~ "#00A3A3", TRUE ~ "white")),
`2017` = cell_spec(`2017`, "latex", background = case_when(`2017_sig` == "HIGHER" ~ "#C3C3FF", `2017_sig` == "LOWER" ~ "#00A3A3", TRUE ~ "white")),
`2018` = cell_spec(`2018`, "latex", background = case_when(`2018_sig` == "HIGHER" ~ "#C3C3FF", `2018_sig` == "LOWER" ~ "#00A3A3", TRUE ~ "white"))) %>%
        select(!tidyselect::all_of(significance_column_names)) %>%
        kable("latex", escape = FALSE)
```
## Table 5.2: Highest level of qualification held by gender and age of adults aged 16 and over
### Column percentages, Adults

### `r main_table_title`

```{r eval=(eval_comparison == FALSE)}
Table_5.2 %>%
kable("latex")
```

```{r eval=eval_comparison}
main_column_names <- colnames(Table_5.2)[!grepl("_2", colnames(Table_5.2))]
significance_column_names <- colnames(Table_5.2)[grepl("_sig", colnames(Table_5.2))]

Table_5.2 %>% select(tidyselect::all_of(main_column_names)) %>%
mutate(`Male` = cell_spec(`Male`, "latex", background = case_when(`Male_sig` == "HIGHER" ~ "#00A3A3", `Male_sig` == "LOWER" ~ "#C3C3FF", TRUE ~ "white")),
`Female` = cell_spec(`Female`, "latex", background = case_when(`Female_sig` == "HIGHER" ~ "#00A3A3", `Female_sig` == "LOWER" ~ "#C3C3FF", TRUE ~ "white")),
`Identified in another way` = cell_spec(`Identified in another way`, "latex", background = case_when(`Identified in another way_sig` == "HIGHER" ~ "#00A3A3", `Identified in another way_sig` == "LOWER" ~ "#C3C3FF", TRUE ~ "white")),
`Refused` = cell_spec(`Refused`, "latex", background = case_when(`Refused_sig` == "HIGHER" ~ "#00A3A3", `Refused_sig` == "LOWER" ~ "#C3C3FF", TRUE ~ "white")),
`16-39` = cell_spec(`16-39`, "latex", background = case_when(`16-39_sig` == "HIGHER" ~ "#00A3A3", `16-39_sig` == "LOWER" ~ "#C3C3FF", TRUE ~ "white")),
`40-59` = cell_spec(`40-59`, "latex", background = case_when(`40-59_sig` == "HIGHER" ~ "#00A3A3", `40-59_sig` == "LOWER" ~ "#C3C3FF", TRUE ~ "white")),
`60 plus` = cell_spec(`60 plus`, "latex", background = case_when(`60 plus_sig` == "HIGHER" ~ "#00A3A3", `60 plus_sig` == "LOWER" ~ "#C3C3FF", TRUE ~ "white"))

) %>%
select(!tidyselect::all_of(significance_column_names)) %>%
kable("latex", escape = FALSE)
```

```{r eval=eval_comparison}
asis_output(paste0("### ", comparison_table_title))
```

```{r eval=eval_comparison}
comparison_column_names <- colnames(Table_5.2)[grepl("_2", colnames(Table_5.2))]
comparison_rename_column_names <- gsub("_2", "", comparison_column_names)

Table_5.2 %>% select(tidyselect::all_of(colnames(Table_5.2)[!colnames(Table_5.2) %in% comparison_rename_column_names])) %>%
rename_at(comparison_column_names, ~ comparison_rename_column_names) %>%
mutate(`Male` = cell_spec(`Male`, "latex", background = case_when(`Male_sig` == "HIGHER" ~ "#C3C3FF", `Male_sig` == "LOWER" ~ "#00A3A3", TRUE ~ "white")),
`Female` = cell_spec(`Female`, "latex", background = case_when(`Female_sig` == "HIGHER" ~ "#C3C3FF", `Female_sig` == "LOWER" ~ "#00A3A3", TRUE ~ "white")),
`Identified in another way` = cell_spec(`Identified in another way`, "latex", background = case_when(`Identified in another way_sig` == "HIGHER" ~ "#C3C3FF", `Identified in another way_sig` == "LOWER" ~ "#00A3A3", TRUE ~ "white")),
`Refused` = cell_spec(`Refused`, "latex", background = case_when(`Refused_sig` == "HIGHER" ~ "#C3C3FF", `Refused_sig` == "LOWER" ~ "#00A3A3", TRUE ~ "white")),
`16-39` = cell_spec(`16-39`, "latex", background = case_when(`16-39_sig` == "HIGHER" ~ "#C3C3FF", `16-39_sig` == "LOWER" ~ "#00A3A3", TRUE ~ "white")),
`40-59` = cell_spec(`40-59`, "latex", background = case_when(`40-59_sig` == "HIGHER" ~ "#C3C3FF", `40-59_sig` == "LOWER" ~ "#00A3A3", TRUE ~ "white")),
`60 plus` = cell_spec(`60 plus`, "latex", background = case_when(`60 plus_sig` == "HIGHER" ~ "#C3C3FF", `60 plus_sig` == "LOWER" ~ "#00A3A3", TRUE ~ "white"))) %>%
        select(!tidyselect::all_of(significance_column_names)) %>%
        kable("latex", escape = FALSE)
```
## Table 5.3, Figure 5.2: Highest level of qualification held by adults aged 16-64 by net annual household income
### Column percentages, Adults

### `r main_table_title`

```{r eval=(eval_comparison == FALSE)}
Table_5.3_Figure_5.2 %>%
kable("latex")
```

```{r eval=eval_comparison}
main_column_names <- colnames(Table_5.3_Figure_5.2)[!grepl("_2", colnames(Table_5.3_Figure_5.2))]
significance_column_names <- colnames(Table_5.3_Figure_5.2)[grepl("_sig", colnames(Table_5.3_Figure_5.2))]

Table_5.3_Figure_5.2 %>% select(tidyselect::all_of(main_column_names)) %>%
mutate(`Up to GBP15,000` = cell_spec(`Up to GBP15,000`, "latex", background = case_when(`Up to GBP15,000_sig` == "HIGHER" ~ "#00A3A3", `Up to GBP15,000_sig` == "LOWER" ~ "#C3C3FF", TRUE ~ "white")),
`GBP15,001 to GBP30,000` = cell_spec(`GBP15,001 to GBP30,000`, "latex", background = case_when(`GBP15,001 to GBP30,000_sig` == "HIGHER" ~ "#00A3A3", `GBP15,001 to GBP30,000_sig` == "LOWER" ~ "#C3C3FF", TRUE ~ "white")),
`Over GBP30,000` = cell_spec(`Over GBP30,000`, "latex", background = case_when(`Over GBP30,000_sig` == "HIGHER" ~ "#00A3A3", `Over GBP30,000_sig` == "LOWER" ~ "#C3C3FF", TRUE ~ "white"))

) %>%
select(!tidyselect::all_of(significance_column_names)) %>%
kable("latex", escape = FALSE)
```

```{r eval=eval_comparison}
asis_output(paste0("### ", comparison_table_title))
```

```{r eval=eval_comparison}
comparison_column_names <- colnames(Table_5.3_Figure_5.2)[grepl("_2", colnames(Table_5.3_Figure_5.2))]
comparison_rename_column_names <- gsub("_2", "", comparison_column_names)

Table_5.3_Figure_5.2 %>% select(tidyselect::all_of(colnames(Table_5.3_Figure_5.2)[!colnames(Table_5.3_Figure_5.2) %in% comparison_rename_column_names])) %>%
rename_at(comparison_column_names, ~ comparison_rename_column_names) %>%
mutate(`Up to GBP15,000` = cell_spec(`Up to GBP15,000`, "latex", background = case_when(`Up to GBP15,000_sig` == "HIGHER" ~ "#C3C3FF", `Up to GBP15,000_sig` == "LOWER" ~ "#00A3A3", TRUE ~ "white")),
`GBP15,001 to GBP30,000` = cell_spec(`GBP15,001 to GBP30,000`, "latex", background = case_when(`GBP15,001 to GBP30,000_sig` == "HIGHER" ~ "#C3C3FF", `GBP15,001 to GBP30,000_sig` == "LOWER" ~ "#00A3A3", TRUE ~ "white")),
`Over GBP30,000` = cell_spec(`Over GBP30,000`, "latex", background = case_when(`Over GBP30,000_sig` == "HIGHER" ~ "#C3C3FF", `Over GBP30,000_sig` == "LOWER" ~ "#00A3A3", TRUE ~ "white"))) %>%
        select(!tidyselect::all_of(significance_column_names)) %>%
        kable("latex", escape = FALSE)
```
## Figure 5.3: Current economic situation of adults aged 16 and over
### Column percentages, Adults

### `r main_table_title`

```{r eval=(eval_comparison == FALSE)}
Figure_5.3 %>%
kable("latex")
```

```{r eval=eval_comparison}
main_column_names <- colnames(Figure_5.3)[!grepl("_2", colnames(Figure_5.3))]
significance_column_names <- colnames(Figure_5.3)[grepl("_sig", colnames(Figure_5.3))]

Figure_5.3 %>% select(tidyselect::all_of(main_column_names)) %>%
mutate(`Man / Boy` = cell_spec(`Man / Boy`, "latex", background = case_when(`Man / Boy_sig` == "HIGHER" ~ "#00A3A3", `Man / Boy_sig` == "LOWER" ~ "#C3C3FF", TRUE ~ "white")),
`Woman / Girl` = cell_spec(`Woman / Girl`, "latex", background = case_when(`Woman / Girl_sig` == "HIGHER" ~ "#00A3A3", `Woman / Girl_sig` == "LOWER" ~ "#C3C3FF", TRUE ~ "white")),
`In another way` = cell_spec(`In another way`, "latex", background = case_when(`In another way_sig` == "HIGHER" ~ "#00A3A3", `In another way_sig` == "LOWER" ~ "#C3C3FF", TRUE ~ "white")),
`Refused` = cell_spec(`Refused`, "latex", background = case_when(`Refused_sig` == "HIGHER" ~ "#00A3A3", `Refused_sig` == "LOWER" ~ "#C3C3FF", TRUE ~ "white"))

) %>%
select(!tidyselect::all_of(significance_column_names)) %>%
kable("latex", escape = FALSE)
```

```{r eval=eval_comparison}
asis_output(paste0("### ", comparison_table_title))
```

```{r eval=eval_comparison}
comparison_column_names <- colnames(Figure_5.3)[grepl("_2", colnames(Figure_5.3))]
comparison_rename_column_names <- gsub("_2", "", comparison_column_names)

Figure_5.3 %>% select(tidyselect::all_of(colnames(Figure_5.3)[!colnames(Figure_5.3) %in% comparison_rename_column_names])) %>%
rename_at(comparison_column_names, ~ comparison_rename_column_names) %>%
mutate(`Man / Boy` = cell_spec(`Man / Boy`, "latex", background = case_when(`Man / Boy_sig` == "HIGHER" ~ "#C3C3FF", `Man / Boy_sig` == "LOWER" ~ "#00A3A3", TRUE ~ "white")),
`Woman / Girl` = cell_spec(`Woman / Girl`, "latex", background = case_when(`Woman / Girl_sig` == "HIGHER" ~ "#C3C3FF", `Woman / Girl_sig` == "LOWER" ~ "#00A3A3", TRUE ~ "white")),
`In another way` = cell_spec(`In another way`, "latex", background = case_when(`In another way_sig` == "HIGHER" ~ "#C3C3FF", `In another way_sig` == "LOWER" ~ "#00A3A3", TRUE ~ "white")),
`Refused` = cell_spec(`Refused`, "latex", background = case_when(`Refused_sig` == "HIGHER" ~ "#C3C3FF", `Refused_sig` == "LOWER" ~ "#00A3A3", TRUE ~ "white"))) %>%
        select(!tidyselect::all_of(significance_column_names)) %>%
        kable("latex", escape = FALSE)
```
## Figure 5.4: Adults aged 16 and over in work over time, 1999-2018
### Column percentages, Adults

### `r main_table_title`

```{r eval=(eval_comparison_time_series == FALSE)}
Figure_5.4 %>%
kable("latex")
```

```{r eval=eval_comparison_time_series}
main_column_names <- colnames(Figure_5.4)[!grepl("_2", colnames(Figure_5.4))]
significance_column_names <- colnames(Figure_5.4)[grepl("_sig", colnames(Figure_5.4))]

Figure_5.4 %>% select(tidyselect::all_of(main_column_names)) %>%
mutate(`1999/2000` = cell_spec(`1999/2000`, "latex", background = case_when(`1999/2000_sig` == "HIGHER" ~ "#00A3A3", `1999/2000_sig` == "LOWER" ~ "#C3C3FF", TRUE ~ "white")),
`2001/2002` = cell_spec(`2001/2002`, "latex", background = case_when(`2001/2002_sig` == "HIGHER" ~ "#00A3A3", `2001/2002_sig` == "LOWER" ~ "#C3C3FF", TRUE ~ "white")),
`2003/2004` = cell_spec(`2003/2004`, "latex", background = case_when(`2003/2004_sig` == "HIGHER" ~ "#00A3A3", `2003/2004_sig` == "LOWER" ~ "#C3C3FF", TRUE ~ "white")),
`2005/2006` = cell_spec(`2005/2006`, "latex", background = case_when(`2005/2006_sig` == "HIGHER" ~ "#00A3A3", `2005/2006_sig` == "LOWER" ~ "#C3C3FF", TRUE ~ "white")),
`2007/2008` = cell_spec(`2007/2008`, "latex", background = case_when(`2007/2008_sig` == "HIGHER" ~ "#00A3A3", `2007/2008_sig` == "LOWER" ~ "#C3C3FF", TRUE ~ "white")),
`2009/2010` = cell_spec(`2009/2010`, "latex", background = case_when(`2009/2010_sig` == "HIGHER" ~ "#00A3A3", `2009/2010_sig` == "LOWER" ~ "#C3C3FF", TRUE ~ "white")),
`2011` = cell_spec(`2011`, "latex", background = case_when(`2011_sig` == "HIGHER" ~ "#00A3A3", `2011_sig` == "LOWER" ~ "#C3C3FF", TRUE ~ "white")),
`2012` = cell_spec(`2012`, "latex", background = case_when(`2012_sig` == "HIGHER" ~ "#00A3A3", `2012_sig` == "LOWER" ~ "#C3C3FF", TRUE ~ "white")),
`2013` = cell_spec(`2013`, "latex", background = case_when(`2013_sig` == "HIGHER" ~ "#00A3A3", `2013_sig` == "LOWER" ~ "#C3C3FF", TRUE ~ "white")),
`2014` = cell_spec(`2014`, "latex", background = case_when(`2014_sig` == "HIGHER" ~ "#00A3A3", `2014_sig` == "LOWER" ~ "#C3C3FF", TRUE ~ "white")),
`2015` = cell_spec(`2015`, "latex", background = case_when(`2015_sig` == "HIGHER" ~ "#00A3A3", `2015_sig` == "LOWER" ~ "#C3C3FF", TRUE ~ "white")),
`2016` = cell_spec(`2016`, "latex", background = case_when(`2016_sig` == "HIGHER" ~ "#00A3A3", `2016_sig` == "LOWER" ~ "#C3C3FF", TRUE ~ "white")),
`2017` = cell_spec(`2017`, "latex", background = case_when(`2017_sig` == "HIGHER" ~ "#00A3A3", `2017_sig` == "LOWER" ~ "#C3C3FF", TRUE ~ "white")),
`2018` = cell_spec(`2018`, "latex", background = case_when(`2018_sig` == "HIGHER" ~ "#00A3A3", `2018_sig` == "LOWER" ~ "#C3C3FF", TRUE ~ "white"))

) %>%
select(!tidyselect::all_of(significance_column_names)) %>%
kable("latex", escape = FALSE)
```

```{r eval=eval_comparison_time_series}
asis_output(paste0("### ", comparison_table_title))
```

```{r eval=eval_comparison_time_series}
comparison_column_names <- colnames(Figure_5.4)[grepl("_2", colnames(Figure_5.4))]
comparison_rename_column_names <- gsub("_2", "", comparison_column_names)

Figure_5.4 %>% select(tidyselect::all_of(colnames(Figure_5.4)[!colnames(Figure_5.4) %in% comparison_rename_column_names])) %>%
rename_at(comparison_column_names, ~ comparison_rename_column_names) %>%
mutate(`1999/2000` = cell_spec(`1999/2000`, "latex", background = case_when(`1999/2000_sig` == "HIGHER" ~ "#C3C3FF", `1999/2000_sig` == "LOWER" ~ "#00A3A3", TRUE ~ "white")),
`2001/2002` = cell_spec(`2001/2002`, "latex", background = case_when(`2001/2002_sig` == "HIGHER" ~ "#C3C3FF", `2001/2002_sig` == "LOWER" ~ "#00A3A3", TRUE ~ "white")),
`2003/2004` = cell_spec(`2003/2004`, "latex", background = case_when(`2003/2004_sig` == "HIGHER" ~ "#C3C3FF", `2003/2004_sig` == "LOWER" ~ "#00A3A3", TRUE ~ "white")),
`2005/2006` = cell_spec(`2005/2006`, "latex", background = case_when(`2005/2006_sig` == "HIGHER" ~ "#C3C3FF", `2005/2006_sig` == "LOWER" ~ "#00A3A3", TRUE ~ "white")),
`2007/2008` = cell_spec(`2007/2008`, "latex", background = case_when(`2007/2008_sig` == "HIGHER" ~ "#C3C3FF", `2007/2008_sig` == "LOWER" ~ "#00A3A3", TRUE ~ "white")),
`2009/2010` = cell_spec(`2009/2010`, "latex", background = case_when(`2009/2010_sig` == "HIGHER" ~ "#C3C3FF", `2009/2010_sig` == "LOWER" ~ "#00A3A3", TRUE ~ "white")),
`2011` = cell_spec(`2011`, "latex", background = case_when(`2011_sig` == "HIGHER" ~ "#C3C3FF", `2011_sig` == "LOWER" ~ "#00A3A3", TRUE ~ "white")),
`2012` = cell_spec(`2012`, "latex", background = case_when(`2012_sig` == "HIGHER" ~ "#C3C3FF", `2012_sig` == "LOWER" ~ "#00A3A3", TRUE ~ "white")),
`2013` = cell_spec(`2013`, "latex", background = case_when(`2013_sig` == "HIGHER" ~ "#C3C3FF", `2013_sig` == "LOWER" ~ "#00A3A3", TRUE ~ "white")),
`2014` = cell_spec(`2014`, "latex", background = case_when(`2014_sig` == "HIGHER" ~ "#C3C3FF", `2014_sig` == "LOWER" ~ "#00A3A3", TRUE ~ "white")),
`2015` = cell_spec(`2015`, "latex", background = case_when(`2015_sig` == "HIGHER" ~ "#C3C3FF", `2015_sig` == "LOWER" ~ "#00A3A3", TRUE ~ "white")),
`2016` = cell_spec(`2016`, "latex", background = case_when(`2016_sig` == "HIGHER" ~ "#C3C3FF", `2016_sig` == "LOWER" ~ "#00A3A3", TRUE ~ "white")),
`2017` = cell_spec(`2017`, "latex", background = case_when(`2017_sig` == "HIGHER" ~ "#C3C3FF", `2017_sig` == "LOWER" ~ "#00A3A3", TRUE ~ "white")),
`2018` = cell_spec(`2018`, "latex", background = case_when(`2018_sig` == "HIGHER" ~ "#C3C3FF", `2018_sig` == "LOWER" ~ "#00A3A3", TRUE ~ "white"))) %>%
        select(!tidyselect::all_of(significance_column_names)) %>%
        kable("latex", escape = FALSE)
```
## Figure 5.5: Current economic situation of adults aged 16-64 over time, 1999-2018
### Column percentages, Adults

### `r main_table_title`

```{r eval=(eval_comparison_time_series == FALSE)}
Figure_5.5 %>%
kable("latex")
```

```{r eval=eval_comparison_time_series}
main_column_names <- colnames(Figure_5.5)[!grepl("_2", colnames(Figure_5.5))]
significance_column_names <- colnames(Figure_5.5)[grepl("_sig", colnames(Figure_5.5))]

Figure_5.5 %>% select(tidyselect::all_of(main_column_names)) %>%
mutate(`1999/2000` = cell_spec(`1999/2000`, "latex", background = case_when(`1999/2000_sig` == "HIGHER" ~ "#00A3A3", `1999/2000_sig` == "LOWER" ~ "#C3C3FF", TRUE ~ "white")),
`2001/2002` = cell_spec(`2001/2002`, "latex", background = case_when(`2001/2002_sig` == "HIGHER" ~ "#00A3A3", `2001/2002_sig` == "LOWER" ~ "#C3C3FF", TRUE ~ "white")),
`2003/2004` = cell_spec(`2003/2004`, "latex", background = case_when(`2003/2004_sig` == "HIGHER" ~ "#00A3A3", `2003/2004_sig` == "LOWER" ~ "#C3C3FF", TRUE ~ "white")),
`2005/2006` = cell_spec(`2005/2006`, "latex", background = case_when(`2005/2006_sig` == "HIGHER" ~ "#00A3A3", `2005/2006_sig` == "LOWER" ~ "#C3C3FF", TRUE ~ "white")),
`2007/2008` = cell_spec(`2007/2008`, "latex", background = case_when(`2007/2008_sig` == "HIGHER" ~ "#00A3A3", `2007/2008_sig` == "LOWER" ~ "#C3C3FF", TRUE ~ "white")),
`2009/2010` = cell_spec(`2009/2010`, "latex", background = case_when(`2009/2010_sig` == "HIGHER" ~ "#00A3A3", `2009/2010_sig` == "LOWER" ~ "#C3C3FF", TRUE ~ "white")),
`2011` = cell_spec(`2011`, "latex", background = case_when(`2011_sig` == "HIGHER" ~ "#00A3A3", `2011_sig` == "LOWER" ~ "#C3C3FF", TRUE ~ "white")),
`2012` = cell_spec(`2012`, "latex", background = case_when(`2012_sig` == "HIGHER" ~ "#00A3A3", `2012_sig` == "LOWER" ~ "#C3C3FF", TRUE ~ "white")),
`2013` = cell_spec(`2013`, "latex", background = case_when(`2013_sig` == "HIGHER" ~ "#00A3A3", `2013_sig` == "LOWER" ~ "#C3C3FF", TRUE ~ "white")),
`2014` = cell_spec(`2014`, "latex", background = case_when(`2014_sig` == "HIGHER" ~ "#00A3A3", `2014_sig` == "LOWER" ~ "#C3C3FF", TRUE ~ "white")),
`2015` = cell_spec(`2015`, "latex", background = case_when(`2015_sig` == "HIGHER" ~ "#00A3A3", `2015_sig` == "LOWER" ~ "#C3C3FF", TRUE ~ "white")),
`2016` = cell_spec(`2016`, "latex", background = case_when(`2016_sig` == "HIGHER" ~ "#00A3A3", `2016_sig` == "LOWER" ~ "#C3C3FF", TRUE ~ "white")),
`2017` = cell_spec(`2017`, "latex", background = case_when(`2017_sig` == "HIGHER" ~ "#00A3A3", `2017_sig` == "LOWER" ~ "#C3C3FF", TRUE ~ "white")),
`2018` = cell_spec(`2018`, "latex", background = case_when(`2018_sig` == "HIGHER" ~ "#00A3A3", `2018_sig` == "LOWER" ~ "#C3C3FF", TRUE ~ "white"))

) %>%
select(!tidyselect::all_of(significance_column_names)) %>%
kable("latex", escape = FALSE)
```

```{r eval=eval_comparison_time_series}
asis_output(paste0("### ", comparison_table_title))
```

```{r eval=eval_comparison_time_series}
comparison_column_names <- colnames(Figure_5.5)[grepl("_2", colnames(Figure_5.5))]
comparison_rename_column_names <- gsub("_2", "", comparison_column_names)

Figure_5.5 %>% select(tidyselect::all_of(colnames(Figure_5.5)[!colnames(Figure_5.5) %in% comparison_rename_column_names])) %>%
rename_at(comparison_column_names, ~ comparison_rename_column_names) %>%
mutate(`1999/2000` = cell_spec(`1999/2000`, "latex", background = case_when(`1999/2000_sig` == "HIGHER" ~ "#C3C3FF", `1999/2000_sig` == "LOWER" ~ "#00A3A3", TRUE ~ "white")),
`2001/2002` = cell_spec(`2001/2002`, "latex", background = case_when(`2001/2002_sig` == "HIGHER" ~ "#C3C3FF", `2001/2002_sig` == "LOWER" ~ "#00A3A3", TRUE ~ "white")),
`2003/2004` = cell_spec(`2003/2004`, "latex", background = case_when(`2003/2004_sig` == "HIGHER" ~ "#C3C3FF", `2003/2004_sig` == "LOWER" ~ "#00A3A3", TRUE ~ "white")),
`2005/2006` = cell_spec(`2005/2006`, "latex", background = case_when(`2005/2006_sig` == "HIGHER" ~ "#C3C3FF", `2005/2006_sig` == "LOWER" ~ "#00A3A3", TRUE ~ "white")),
`2007/2008` = cell_spec(`2007/2008`, "latex", background = case_when(`2007/2008_sig` == "HIGHER" ~ "#C3C3FF", `2007/2008_sig` == "LOWER" ~ "#00A3A3", TRUE ~ "white")),
`2009/2010` = cell_spec(`2009/2010`, "latex", background = case_when(`2009/2010_sig` == "HIGHER" ~ "#C3C3FF", `2009/2010_sig` == "LOWER" ~ "#00A3A3", TRUE ~ "white")),
`2011` = cell_spec(`2011`, "latex", background = case_when(`2011_sig` == "HIGHER" ~ "#C3C3FF", `2011_sig` == "LOWER" ~ "#00A3A3", TRUE ~ "white")),
`2012` = cell_spec(`2012`, "latex", background = case_when(`2012_sig` == "HIGHER" ~ "#C3C3FF", `2012_sig` == "LOWER" ~ "#00A3A3", TRUE ~ "white")),
`2013` = cell_spec(`2013`, "latex", background = case_when(`2013_sig` == "HIGHER" ~ "#C3C3FF", `2013_sig` == "LOWER" ~ "#00A3A3", TRUE ~ "white")),
`2014` = cell_spec(`2014`, "latex", background = case_when(`2014_sig` == "HIGHER" ~ "#C3C3FF", `2014_sig` == "LOWER" ~ "#00A3A3", TRUE ~ "white")),
`2015` = cell_spec(`2015`, "latex", background = case_when(`2015_sig` == "HIGHER" ~ "#C3C3FF", `2015_sig` == "LOWER" ~ "#00A3A3", TRUE ~ "white")),
`2016` = cell_spec(`2016`, "latex", background = case_when(`2016_sig` == "HIGHER" ~ "#C3C3FF", `2016_sig` == "LOWER" ~ "#00A3A3", TRUE ~ "white")),
`2017` = cell_spec(`2017`, "latex", background = case_when(`2017_sig` == "HIGHER" ~ "#C3C3FF", `2017_sig` == "LOWER" ~ "#00A3A3", TRUE ~ "white")),
`2018` = cell_spec(`2018`, "latex", background = case_when(`2018_sig` == "HIGHER" ~ "#C3C3FF", `2018_sig` == "LOWER" ~ "#00A3A3", TRUE ~ "white"))) %>%
        select(!tidyselect::all_of(significance_column_names)) %>%
        kable("latex", escape = FALSE)
```
## Figure 5.6: Current economic situation of adults aged 16-64 by gender
### Column percentages, Adults

### `r main_table_title`

```{r eval=(eval_comparison == FALSE)}
Figure_5.6 %>%
kable("latex")
```

```{r eval=eval_comparison}
main_column_names <- colnames(Figure_5.6)[!grepl("_2", colnames(Figure_5.6))]
significance_column_names <- colnames(Figure_5.6)[grepl("_sig", colnames(Figure_5.6))]

Figure_5.6 %>% select(tidyselect::all_of(main_column_names)) %>%
mutate(`Man / Boy` = cell_spec(`Man / Boy`, "latex", background = case_when(`Man / Boy_sig` == "HIGHER" ~ "#00A3A3", `Man / Boy_sig` == "LOWER" ~ "#C3C3FF", TRUE ~ "white")),
`Woman / Girl` = cell_spec(`Woman / Girl`, "latex", background = case_when(`Woman / Girl_sig` == "HIGHER" ~ "#00A3A3", `Woman / Girl_sig` == "LOWER" ~ "#C3C3FF", TRUE ~ "white")),
`In another way` = cell_spec(`In another way`, "latex", background = case_when(`In another way_sig` == "HIGHER" ~ "#00A3A3", `In another way_sig` == "LOWER" ~ "#C3C3FF", TRUE ~ "white")),
`Refused` = cell_spec(`Refused`, "latex", background = case_when(`Refused_sig` == "HIGHER" ~ "#00A3A3", `Refused_sig` == "LOWER" ~ "#C3C3FF", TRUE ~ "white"))

) %>%
select(!tidyselect::all_of(significance_column_names)) %>%
kable("latex", escape = FALSE)
```

```{r eval=eval_comparison}
asis_output(paste0("### ", comparison_table_title))
```

```{r eval=eval_comparison}
comparison_column_names <- colnames(Figure_5.6)[grepl("_2", colnames(Figure_5.6))]
comparison_rename_column_names <- gsub("_2", "", comparison_column_names)

Figure_5.6 %>% select(tidyselect::all_of(colnames(Figure_5.6)[!colnames(Figure_5.6) %in% comparison_rename_column_names])) %>%
rename_at(comparison_column_names, ~ comparison_rename_column_names) %>%
mutate(`Man / Boy` = cell_spec(`Man / Boy`, "latex", background = case_when(`Man / Boy_sig` == "HIGHER" ~ "#C3C3FF", `Man / Boy_sig` == "LOWER" ~ "#00A3A3", TRUE ~ "white")),
`Woman / Girl` = cell_spec(`Woman / Girl`, "latex", background = case_when(`Woman / Girl_sig` == "HIGHER" ~ "#C3C3FF", `Woman / Girl_sig` == "LOWER" ~ "#00A3A3", TRUE ~ "white")),
`In another way` = cell_spec(`In another way`, "latex", background = case_when(`In another way_sig` == "HIGHER" ~ "#C3C3FF", `In another way_sig` == "LOWER" ~ "#00A3A3", TRUE ~ "white")),
`Refused` = cell_spec(`Refused`, "latex", background = case_when(`Refused_sig` == "HIGHER" ~ "#C3C3FF", `Refused_sig` == "LOWER" ~ "#00A3A3", TRUE ~ "white"))) %>%
        select(!tidyselect::all_of(significance_column_names)) %>%
        kable("latex", escape = FALSE)
```
## Table 5.4: Current economic situation of adults aged 16-64 by highest level of qualification
### Column percentages, Adults

### `r main_table_title`

```{r eval=(eval_comparison == FALSE)}
Table_5.4 %>%
kable("latex")
```

```{r eval=eval_comparison}
main_column_names <- colnames(Table_5.4)[!grepl("_2", colnames(Table_5.4))]
significance_column_names <- colnames(Table_5.4)[grepl("_sig", colnames(Table_5.4))]

Table_5.4 %>% select(tidyselect::all_of(main_column_names)) %>%
mutate(`Degree / professional qualification` = cell_spec(`Degree / professional qualification`, "latex", background = case_when(`Degree / professional qualification_sig` == "HIGHER" ~ "#00A3A3", `Degree / professional qualification_sig` == "LOWER" ~ "#C3C3FF", TRUE ~ "white")),
`Higher/A level/O Grade/Standard Grade` = cell_spec(`Higher/A level/O Grade/Standard Grade`, "latex", background = case_when(`Higher/A level/O Grade/Standard Grade_sig` == "HIGHER" ~ "#00A3A3", `Higher/A level/O Grade/Standard Grade_sig` == "LOWER" ~ "#C3C3FF", TRUE ~ "white")),
`Other qualification` = cell_spec(`Other qualification`, "latex", background = case_when(`Other qualification_sig` == "HIGHER" ~ "#00A3A3", `Other qualification_sig` == "LOWER" ~ "#C3C3FF", TRUE ~ "white")),
`No qualifications` = cell_spec(`No qualifications`, "latex", background = case_when(`No qualifications_sig` == "HIGHER" ~ "#00A3A3", `No qualifications_sig` == "LOWER" ~ "#C3C3FF", TRUE ~ "white")),
`Qualifications not known` = cell_spec(`Qualifications not known`, "latex", background = case_when(`Qualifications not known_sig` == "HIGHER" ~ "#00A3A3", `Qualifications not known_sig` == "LOWER" ~ "#C3C3FF", TRUE ~ "white"))

) %>%
select(!tidyselect::all_of(significance_column_names)) %>%
kable("latex", escape = FALSE)
```

```{r eval=eval_comparison}
asis_output(paste0("### ", comparison_table_title))
```

```{r eval=eval_comparison}
comparison_column_names <- colnames(Table_5.4)[grepl("_2", colnames(Table_5.4))]
comparison_rename_column_names <- gsub("_2", "", comparison_column_names)

Table_5.4 %>% select(tidyselect::all_of(colnames(Table_5.4)[!colnames(Table_5.4) %in% comparison_rename_column_names])) %>%
rename_at(comparison_column_names, ~ comparison_rename_column_names) %>%
mutate(`Degree / professional qualification` = cell_spec(`Degree / professional qualification`, "latex", background = case_when(`Degree / professional qualification_sig` == "HIGHER" ~ "#C3C3FF", `Degree / professional qualification_sig` == "LOWER" ~ "#00A3A3", TRUE ~ "white")),
`Higher/A level/O Grade/Standard Grade` = cell_spec(`Higher/A level/O Grade/Standard Grade`, "latex", background = case_when(`Higher/A level/O Grade/Standard Grade_sig` == "HIGHER" ~ "#C3C3FF", `Higher/A level/O Grade/Standard Grade_sig` == "LOWER" ~ "#00A3A3", TRUE ~ "white")),
`Other qualification` = cell_spec(`Other qualification`, "latex", background = case_when(`Other qualification_sig` == "HIGHER" ~ "#C3C3FF", `Other qualification_sig` == "LOWER" ~ "#00A3A3", TRUE ~ "white")),
`No qualifications` = cell_spec(`No qualifications`, "latex", background = case_when(`No qualifications_sig` == "HIGHER" ~ "#C3C3FF", `No qualifications_sig` == "LOWER" ~ "#00A3A3", TRUE ~ "white")),
`Qualifications not known` = cell_spec(`Qualifications not known`, "latex", background = case_when(`Qualifications not known_sig` == "HIGHER" ~ "#C3C3FF", `Qualifications not known_sig` == "LOWER" ~ "#00A3A3", TRUE ~ "white"))) %>%
        select(!tidyselect::all_of(significance_column_names)) %>%
        kable("latex", escape = FALSE)
```
## Table 5.5: Current economic situation of adults aged 16-64 by long-standing limiting illness, health problem or disability
### Column percentages, Adults

### `r main_table_title`

```{r eval=(eval_comparison == FALSE)}
Table_5.5 %>%
kable("latex")
```

```{r eval=eval_comparison}
main_column_names <- colnames(Table_5.5)[!grepl("_2", colnames(Table_5.5))]
significance_column_names <- colnames(Table_5.5)[grepl("_sig", colnames(Table_5.5))]

Table_5.5 %>% select(tidyselect::all_of(main_column_names)) %>%
mutate(`Yes long-term condition` = cell_spec(`Yes long-term condition`, "latex", background = case_when(`Yes long-term condition_sig` == "HIGHER" ~ "#00A3A3", `Yes long-term condition_sig` == "LOWER" ~ "#C3C3FF", TRUE ~ "white")),
`No long-term condition` = cell_spec(`No long-term condition`, "latex", background = case_when(`No long-term condition_sig` == "HIGHER" ~ "#00A3A3", `No long-term condition_sig` == "LOWER" ~ "#C3C3FF", TRUE ~ "white")),
`Yes ('excluding permanently sick or disabled')` = cell_spec(`Yes ('excluding permanently sick or disabled')`, "latex", background = case_when(`Yes ('excluding permanently sick or disabled')_sig` == "HIGHER" ~ "#00A3A3", `Yes ('excluding permanently sick or disabled')_sig` == "LOWER" ~ "#C3C3FF", TRUE ~ "white")),
`No ('excluding permanently sick or disabled')` = cell_spec(`No ('excluding permanently sick or disabled')`, "latex", background = case_when(`No ('excluding permanently sick or disabled')_sig` == "HIGHER" ~ "#00A3A3", `No ('excluding permanently sick or disabled')_sig` == "LOWER" ~ "#C3C3FF", TRUE ~ "white")),
`All ('excluding permanently sick or disabled')` = cell_spec(`All ('excluding permanently sick or disabled')`, "latex", background = case_when(`All ('excluding permanently sick or disabled')_sig` == "HIGHER" ~ "#00A3A3", `All ('excluding permanently sick or disabled')_sig` == "LOWER" ~ "#C3C3FF", TRUE ~ "white"))

) %>%
select(!tidyselect::all_of(significance_column_names)) %>%
kable("latex", escape = FALSE)
```

```{r eval=eval_comparison}
asis_output(paste0("### ", comparison_table_title))
```

```{r eval=eval_comparison}
comparison_column_names <- colnames(Table_5.5)[grepl("_2", colnames(Table_5.5))]
comparison_rename_column_names <- gsub("_2", "", comparison_column_names)

Table_5.5 %>% select(tidyselect::all_of(colnames(Table_5.5)[!colnames(Table_5.5) %in% comparison_rename_column_names])) %>%
rename_at(comparison_column_names, ~ comparison_rename_column_names) %>%
mutate(`Yes long-term condition` = cell_spec(`Yes long-term condition`, "latex", background = case_when(`Yes long-term condition_sig` == "HIGHER" ~ "#C3C3FF", `Yes long-term condition_sig` == "LOWER" ~ "#00A3A3", TRUE ~ "white")),
`No long-term condition` = cell_spec(`No long-term condition`, "latex", background = case_when(`No long-term condition_sig` == "HIGHER" ~ "#C3C3FF", `No long-term condition_sig` == "LOWER" ~ "#00A3A3", TRUE ~ "white")),
`Yes ('excluding permanently sick or disabled')` = cell_spec(`Yes ('excluding permanently sick or disabled')`, "latex", background = case_when(`Yes ('excluding permanently sick or disabled')_sig` == "HIGHER" ~ "#C3C3FF", `Yes ('excluding permanently sick or disabled')_sig` == "LOWER" ~ "#00A3A3", TRUE ~ "white")),
`No ('excluding permanently sick or disabled')` = cell_spec(`No ('excluding permanently sick or disabled')`, "latex", background = case_when(`No ('excluding permanently sick or disabled')_sig` == "HIGHER" ~ "#C3C3FF", `No ('excluding permanently sick or disabled')_sig` == "LOWER" ~ "#00A3A3", TRUE ~ "white")),
`All ('excluding permanently sick or disabled')` = cell_spec(`All ('excluding permanently sick or disabled')`, "latex", background = case_when(`All ('excluding permanently sick or disabled')_sig` == "HIGHER" ~ "#C3C3FF", `All ('excluding permanently sick or disabled')_sig` == "LOWER" ~ "#00A3A3", TRUE ~ "white"))) %>%
        select(!tidyselect::all_of(significance_column_names)) %>%
        kable("latex", escape = FALSE)
```
## Figure 5.7: Number of adults aged 16 or over in paid employment by Scottish Index of Multiple Deprivation
### Column percentages, Adults

### `r main_table_title`

```{r eval=(eval_comparison == FALSE)}
Figure_5.7 %>%
kable("latex")
```

```{r eval=eval_comparison}
main_column_names <- colnames(Figure_5.7)[!grepl("_2", colnames(Figure_5.7))]
significance_column_names <- colnames(Figure_5.7)[grepl("_sig", colnames(Figure_5.7))]

Figure_5.7 %>% select(tidyselect::all_of(main_column_names)) %>%
mutate(`1 - 20pc most deprived` = cell_spec(`1 - 20pc most deprived`, "latex", background = case_when(`1 - 20pc most deprived_sig` == "HIGHER" ~ "#00A3A3", `1 - 20pc most deprived_sig` == "LOWER" ~ "#C3C3FF", TRUE ~ "white")),
`2` = cell_spec(`2`, "latex", background = case_when(`2_sig` == "HIGHER" ~ "#00A3A3", `2_sig` == "LOWER" ~ "#C3C3FF", TRUE ~ "white")),
`3` = cell_spec(`3`, "latex", background = case_when(`3_sig` == "HIGHER" ~ "#00A3A3", `3_sig` == "LOWER" ~ "#C3C3FF", TRUE ~ "white")),
`4` = cell_spec(`4`, "latex", background = case_when(`4_sig` == "HIGHER" ~ "#00A3A3", `4_sig` == "LOWER" ~ "#C3C3FF", TRUE ~ "white")),
`5 - 20pc least deprived` = cell_spec(`5 - 20pc least deprived`, "latex", background = case_when(`5 - 20pc least deprived_sig` == "HIGHER" ~ "#00A3A3", `5 - 20pc least deprived_sig` == "LOWER" ~ "#C3C3FF", TRUE ~ "white"))

) %>%
select(!tidyselect::all_of(significance_column_names)) %>%
kable("latex", escape = FALSE)
```

```{r eval=eval_comparison}
asis_output(paste0("### ", comparison_table_title))
```

```{r eval=eval_comparison}
comparison_column_names <- colnames(Figure_5.7)[grepl("_2", colnames(Figure_5.7))]
comparison_rename_column_names <- gsub("_2", "", comparison_column_names)

Figure_5.7 %>% select(tidyselect::all_of(colnames(Figure_5.7)[!colnames(Figure_5.7) %in% comparison_rename_column_names])) %>%
rename_at(comparison_column_names, ~ comparison_rename_column_names) %>%
mutate(`1 - 20pc most deprived` = cell_spec(`1 - 20pc most deprived`, "latex", background = case_when(`1 - 20pc most deprived_sig` == "HIGHER" ~ "#C3C3FF", `1 - 20pc most deprived_sig` == "LOWER" ~ "#00A3A3", TRUE ~ "white")),
`2` = cell_spec(`2`, "latex", background = case_when(`2_sig` == "HIGHER" ~ "#C3C3FF", `2_sig` == "LOWER" ~ "#00A3A3", TRUE ~ "white")),
`3` = cell_spec(`3`, "latex", background = case_when(`3_sig` == "HIGHER" ~ "#C3C3FF", `3_sig` == "LOWER" ~ "#00A3A3", TRUE ~ "white")),
`4` = cell_spec(`4`, "latex", background = case_when(`4_sig` == "HIGHER" ~ "#C3C3FF", `4_sig` == "LOWER" ~ "#00A3A3", TRUE ~ "white")),
`5 - 20pc least deprived` = cell_spec(`5 - 20pc least deprived`, "latex", background = case_when(`5 - 20pc least deprived_sig` == "HIGHER" ~ "#C3C3FF", `5 - 20pc least deprived_sig` == "LOWER" ~ "#00A3A3", TRUE ~ "white"))) %>%
        select(!tidyselect::all_of(significance_column_names)) %>%
        kable("latex", escape = FALSE)
```
## Figure 5.8: Current economic situation of women aged 16-64 by the presence of children in the household
### Column percentages, Adults

### `r main_table_title`

```{r eval=(eval_comparison == FALSE)}
Figure_5.8 %>%
kable("latex")
```

```{r eval=eval_comparison}
main_column_names <- colnames(Figure_5.8)[!grepl("_2", colnames(Figure_5.8))]
significance_column_names <- colnames(Figure_5.8)[grepl("_sig", colnames(Figure_5.8))]

Figure_5.8 %>% select(tidyselect::all_of(main_column_names)) %>%
mutate(`Yes have children` = cell_spec(`Yes have children`, "latex", background = case_when(`Yes have children_sig` == "HIGHER" ~ "#00A3A3", `Yes have children_sig` == "LOWER" ~ "#C3C3FF", TRUE ~ "white")),
`No children` = cell_spec(`No children`, "latex", background = case_when(`No children_sig` == "HIGHER" ~ "#00A3A3", `No children_sig` == "LOWER" ~ "#C3C3FF", TRUE ~ "white"))

) %>%
select(!tidyselect::all_of(significance_column_names)) %>%
kable("latex", escape = FALSE)
```

```{r eval=eval_comparison}
asis_output(paste0("### ", comparison_table_title))
```

```{r eval=eval_comparison}
comparison_column_names <- colnames(Figure_5.8)[grepl("_2", colnames(Figure_5.8))]
comparison_rename_column_names <- gsub("_2", "", comparison_column_names)

Figure_5.8 %>% select(tidyselect::all_of(colnames(Figure_5.8)[!colnames(Figure_5.8) %in% comparison_rename_column_names])) %>%
rename_at(comparison_column_names, ~ comparison_rename_column_names) %>%
mutate(`Yes have children` = cell_spec(`Yes have children`, "latex", background = case_when(`Yes have children_sig` == "HIGHER" ~ "#C3C3FF", `Yes have children_sig` == "LOWER" ~ "#00A3A3", TRUE ~ "white")),
`No children` = cell_spec(`No children`, "latex", background = case_when(`No children_sig` == "HIGHER" ~ "#C3C3FF", `No children_sig` == "LOWER" ~ "#00A3A3", TRUE ~ "white"))) %>%
        select(!tidyselect::all_of(significance_column_names)) %>%
        kable("latex", escape = FALSE)
```
